<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>JJFUTBOL PREMIUM</title>
  
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* --- ESTILOS PREMIUM (TEMA GOLD/DARK) --- */
    :root {
      --bg-dark: #000000;
      --card-bg: rgba(20, 25, 40, 0.85);
      --card-border: rgba(255, 255, 255, 0.1);
      --accent: #D4AF37; /* Dorado JJ */
      --text-main: #ffffff;
      --text-muted: #9ca3af;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Open Sans', sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #000000 100%);
      margin: 0; padding: 0; color: var(--text-main);
      min-height: 100vh; overflow-x: hidden;
    }

    /* SISTEMA DE VISTAS (SPA) */
    .view-section {
      width: 100%; min-height: 100vh;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }
    .hidden { display: none !important; opacity: 0; pointer-events: none; }

    /* HEADER PREMIUM */
    header {
      text-align: center; padding: 20px 0 10px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
      position: sticky; top: 0; z-index: 50; backdrop-filter: blur(8px);
    }
    .app-title {
      font-family: 'Poppins', sans-serif; font-size: 26px; font-weight: 800;
      margin: 0; text-transform: uppercase; letter-spacing: 1px;
      background: linear-gradient(to right, #fff, #D4AF37);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));
    }
    .app-subtitle { 
      font-size: 10px; color: var(--accent); letter-spacing: 4px; font-weight: 700; margin-top: -5px; 
      text-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
    }

    /* ================= VISTA 1: AGENDA ================= */
    .container { max-width: 800px; margin: 0 auto; padding: 10px 15px 80px; }

    /* Banner Rojo (Pel칤culas) */
    .promo-box {
      background: linear-gradient(135deg, #1a0d0d, #2a0f0f); color: white;
      padding: 15px; text-align: center; border-radius: 16px;
      border: 1px solid rgba(204, 51, 0, 0.4); margin-bottom: 20px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5); position: relative;
    }
    .promo-badge {
      position: absolute; top: -10px; right: -10px; width: 40px; height: 40px;
      background: #ff3300; border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-weight: bold; font-size: 16px; box-shadow: 0 0 10px rgba(255, 51, 0, 0.6);
    }
    .btn-promo {
      display: inline-block; background: linear-gradient(to right, #cc3300, #ff5500);
      color: white; font-weight: 700; padding: 6px 15px; border-radius: 20px;
      text-decoration: none; font-size: 12px; margin-top: 5px;
    }

    /* Tarjetas de Partidos */
    #menu { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 12px; }

    .match-card {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 14px; overflow: hidden; backdrop-filter: blur(10px);
      transition: transform 0.2s, border-color 0.2s;
    }
    .match-card.active { border-color: var(--accent); background: rgba(30, 35, 50, 0.95); }

    .card-header { padding: 12px 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; }
    
    .time-badge {
      background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 6px;
      font-weight: 700; color: #10b981; font-size: 12px; min-width: 50px; text-align: center;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .match-info { flex: 1; display: flex; align-items: center; margin: 0 12px; overflow: hidden; }
    .league-flag { width: 24px; height: 24px; border-radius: 50%; margin-right: 10px; flex-shrink: 0; border: 1px solid rgba(255,255,255,0.2); }
    .match-title { font-size: 13px; font-weight: 600; color: #e2e8f0; line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    .toggle-icon { color: var(--text-muted); font-size: 12px; transition: transform 0.3s; }
    .match-card.active .toggle-icon { transform: rotate(180deg); color: var(--accent); }

    /* Lista de Canales */
    .channels-container { display: none; padding: 0 15px 15px; background: rgba(0,0,0,0.2); border-top: 1px solid rgba(255,255,255,0.05); }
    .channels-list { list-style: none; padding: 10px 0 0; margin: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 8px; }

    .channel-btn {
      display: flex; align-items: center; justify-content: center; gap: 6px;
      padding: 10px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; color: white; font-size: 11px; font-weight: 600; cursor: pointer;
      transition: all 0.2s; text-transform: uppercase;
    }
    .channel-btn:hover { background: var(--accent); color: black; border-color: var(--accent); }
    .channel-btn i { font-size: 10px; }

    /* ================= VISTA 2: REPRODUCTOR (TITAN V9) ================= */
    
    /* Barra Volver */
    .player-header {
      padding: 10px 15px; display: flex; align-items: center;
      max-width: 900px; margin: 0 auto;
    }
    .btn-back {
      background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1);
      color: white; padding: 8px 20px; border-radius: 20px; font-size: 13px;
      font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;
    }

    /* Contenedor Video */
    .viewer-wrapper {
      width: 100%; max-width: 900px; margin: 10px auto; padding: 0 15px;
      position: relative; z-index: 10;
    }
    .video-box {
      position: relative; width: 100%; padding-bottom: 56.25%; /* 16:9 */
      background: #000; border-radius: 12px; overflow: hidden;
      box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      border: 1px solid rgba(212, 175, 55, 0.2); z-index: 20;
    }
    iframe#viewer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: 1; }

    /* ESCUDO ANTI-ADS (Invisible) */
    .click-shield {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      z-index: 10; background: transparent; cursor: pointer;
    }

    /* BOT칍N DESBLOQUEAR (Opci칩n 2 - Dise침o Glass) */
    .unlock-btn {
      position: absolute; top: 10px; right: 10px; z-index: 50;
      background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px);
      border: 1px solid #ff4444; color: #ffcccc;
      padding: 6px 12px; border-radius: 30px; font-size: 10px; font-weight: 700;
      text-transform: uppercase; cursor: pointer; display: none; align-items: center; gap: 5px;
    }

    /* Botonera Acci칩n */
    .action-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
      max-width: 900px; margin: 15px auto; padding: 0 15px;
    }
    .btn-action {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      padding: 12px; border-radius: 12px; text-decoration: none;
      font-weight: 700; font-size: 12px; color: white; border: 1px solid rgba(255,255,255,0.1);
    }
    .btn-telegram { background: linear-gradient(90deg, #229ED9, #1c7caf); }
    .btn-movies { background: linear-gradient(90deg, #D4AF37, #b8860b); color: black; }

    /* Chat Desplegable */
    .chat-section { width: 100%; max-width: 900px; margin: 0 auto 30px; padding: 0 15px; }
    
    .chat-toggle {
      width: 100%; padding: 12px;
      background: rgba(30, 35, 50, 0.8); border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 12px; color: #D4AF37; cursor: pointer; font-weight: 600; font-size: 13px;
      display: flex; justify-content: center; align-items: center; gap: 8px;
    }
    
    .chat-content {
      max-height: 0; overflow: hidden; transition: max-height 0.4s ease;
      background: rgba(20, 25, 40, 0.9); border-radius: 0 0 12px 12px;
      margin-top: -5px; opacity: 0;
    }
    .chat-content.show { max-height: 500px; opacity: 1; border: 1px solid rgba(212, 175, 55, 0.2); border-top: none; }

    /* Loading / Mensajes */
    .loading-container { text-align: center; padding: 60px 0; color: #666; }
    .spinner { width: 35px; height: 35px; border: 3px solid rgba(255,255,255,0.1); border-left-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 10px; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

  </style>
</head>
<body>

  <header>
    <h1 class="app-title">JJFUTBOL</h1>
    <div class="app-subtitle">PREMIUM</div>
  </header>

  <div id="view-agenda" class="view-section">
    <div class="container">
      
      <div class="promo-box">
        <div class="promo-badge">游꿟</div>
        <h3 style="font-family:'Poppins'; margin:0 0 5px; color:#ff4d00; font-size:16px;">Pel칤culas Gratis 2026</h3>
        <p style="font-size:12px; color:#ccc; margin-bottom:5px;">Estrenos y series exclusivas.</p>
        <a href="https://jjmovies.lat" target="_blank" class="btn-promo">Entrar a JJMOVIES</a>
      </div>

      <h3 id="agenda-date" style="text-align:center; color:var(--text-main); font-family:'Poppins'; margin:0 0 15px; font-size:14px; opacity:0.8;">CARGANDO EVENTOS...</h3>

      <ul id="menu"></ul>
    </div>
  </div>

  <div id="view-player" class="view-section hidden">
    
    <div class="player-header">
      <button class="btn-back" onclick="closePlayer()">
        <i class="fas fa-arrow-left"></i> VOLVER A LA AGENDA
      </button>
    </div>

    <div class="viewer-wrapper">
      <div class="video-box" id="player-box">
        <button class="unlock-btn" id="unlock-btn" onclick="desbloquearReproductor()">
          <i class="fas fa-lock-open"></i> Desbloquear / Opci칩n 2
        </button>

        <div id="click-shield" class="click-shield" onclick="removeShield()"></div>

        <iframe id="viewer" src="" allowfullscreen allow="autoplay; encrypted-media"></iframe>
      </div>
    </div>

    <div class="action-grid">
      <a href="https://t.me/+EPyKMpHXlv5lMmYx" target="_blank" class="btn-action btn-telegram">
        <i class="fab fa-telegram-plane"></i> Telegram
      </a>
      <a href="https://jjmovies.lat" target="_blank" class="btn-action btn-movies">
        <i class="fas fa-film"></i> Pel칤culas
      </a>
    </div>

    <div class="chat-section">
      <button class="chat-toggle" onclick="toggleChat(this)">
        <span><i class="fas fa-comments"></i> CHAT DE LA COMUNIDAD</span>
        <i class="fas fa-chevron-down arrow"></i>
      </button>
      <div class="chat-content" id="chat-wrapper">
        <iframe id="chat-frame" src="" width="100%" height="400" frameborder="0" scrolling="auto" allowtransparency="true"></iframe>
      </div>
    </div>

    <div style="text-align:center; padding:20px; font-size:11px; color:#555;">
      Usa <span style="color:#D4AF37;">1.1.1.1 VPN</span> si el video se corta.
    </div>
  </div>

  <script>
    // --- 1. CONFIGURACI칍N 칔NICA Y PROXY ---
    // Usamos AllOrigins para saltar el bloqueo de GoolHD
    const AGENDA_REAL = "https://goolhd.com/agenda.json?v=1.07";
    const AGENDA_PROXY = "https://api.allorigins.win/raw?url=" + encodeURIComponent(AGENDA_REAL);
    const IMG_BASE = "https://img.goolhd.com";

    document.addEventListener("DOMContentLoaded", () => {
      cargarAgenda();
      
      // Expandir tarjeta
      $(document).on("click", ".match-card", function() {
        const $this = $(this);
        const $submenu = $this.find(".channels-container");
        $(".match-card").not($this).removeClass("active").find(".channels-container").slideUp(200);
        $this.toggleClass("active");
        $submenu.slideToggle(200);
      });

      // Prevenir cierre al tocar bot칩n
      $(document).on("click", ".channel-btn", e => e.stopPropagation());
      
      // Auto-actualizar
      setInterval(cargarAgenda, 60000);
    });

    async function cargarAgenda() {
      const menu = document.getElementById("menu");
      if(menu.innerHTML.trim() === "") menu.innerHTML = '<div class="loading-container"><div class="spinner"></div><p>Buscando partidos...</p></div>';

      try {
        const response = await fetch(AGENDA_PROXY + "&t=" + Date.now());
        const json = await response.json();
        const eventos = json.data || [];

        if(eventos.length === 0) {
          menu.innerHTML = '<div style="text-align:center; padding:40px; color:#ef4444;"><i class="fas fa-exclamation-circle"></i> No hay eventos hoy.</div>';
          document.getElementById("agenda-date").textContent = "SIN EVENTOS";
          return;
        }

        // Filtrar y Ordenar
        const unicos = [];
        const vistos = new Set();
        eventos.forEach(ev => {
          const k = (ev.attributes?.diary_description || "") + (ev.attributes?.diary_hour || "");
          if(!vistos.has(k)) { vistos.add(k); unicos.push(ev); }
        });
        
        unicos.sort((a,b) => {
          const da = (a.attributes?.date_diary || "") + (a.attributes?.diary_hour || "");
          const db = (b.attributes?.date_diary || "") + (b.attributes?.diary_hour || "");
          return da.localeCompare(db);
        });

        // Fecha T칤tulo
        if(unicos.length > 0) {
          const d = unicos[0].attributes?.date_diary;
          if(d) {
            const [y,m,dia] = d.split('-').map(Number);
            const fecha = new Date(y, m-1, dia);
            document.getElementById("agenda-date").textContent = fecha.toLocaleDateString("es-ES", {weekday:'long', day:'numeric', month:'long'}).toUpperCase();
          }
        }

        let html = "";
        unicos.forEach((item, i) => {
          const attr = item.attributes || {};
          let hora = "--:--";
          if(attr.diary_hour) {
            // Intentar convertir la hora
             try {
                const dt = luxon.DateTime.fromFormat(attr.diary_hour.substring(0,5), "HH:mm", {zone:"America/Lima"});
                if(dt.isValid) hora = dt.toLocal().toFormat("HH:mm");
                else hora = attr.diary_hour.substring(0,5);
             } catch(e) { hora = attr.diary_hour; }
          }
          
          const img = attr.country?.data?.attributes?.image?.data?.attributes?.url ? IMG_BASE + attr.country.data.attributes.image.data.attributes.url : "https://via.placeholder.com/24?text=TV";
          
          let botones = "";
          (attr.embeds?.data || []).forEach(em => {
            const name = em.attributes.embed_name || "Ver Canal";
            const rawUrl = em.attributes.embed_iframe || "";
            
            let finalR = "";
            try {
              if(rawUrl.includes("?r=")) finalR = rawUrl.split("?r=")[1].split("&")[0];
              else if(rawUrl.startsWith("http")) finalR = btoa(rawUrl);
            } catch(e){}

            if(finalR) {
              botones += `<li><div class="channel-btn" onclick="openPlayer('${finalR}')"><i class="fas fa-play"></i> ${name}</div></li>`;
            }
          });

          if(!botones) botones = '<li style="text-align:center; color:#666; font-size:11px; padding:10px;">Pr칩ximamente...</li>';

          html += `
            <li class="match-card" style="animation: fadeIn 0.5s ease forwards; animation-delay: ${i*0.05}s; opacity:0;">
              <div class="card-header">
                <div class="time-badge">${hora}</div>
                <div class="match-info">
                  <img class="league-flag" src="${img}">
                  <span class="match-title">${attr.diary_description}</span>
                </div>
                <i class="fas fa-chevron-down toggle-icon"></i>
              </div>
              <div class="channels-container">
                <ul class="channels-list">${botones}</ul>
              </div>
            </li>
          `;
        });
        menu.innerHTML = html;

      } catch (e) {
        menu.innerHTML = '<div style="text-align:center; padding:40px; color:#ef4444;">Error de conexi칩n.<br>Intenta m치s tarde.</div>';
        console.error(e);
      }
    }

    // --- 2. L칍GICA DEL REPRODUCTOR ---
    const viewer = document.getElementById('viewer');
    const shield = document.getElementById('click-shield');
    const unlockBtn = document.getElementById('unlock-btn');
    const chatFrame = document.getElementById('chat-frame');
    let currentUrl = '';
    let chatLoaded = false;

    function openPlayer(encodedR) {
      document.getElementById('view-agenda').classList.add('hidden');
      document.getElementById('view-player').classList.remove('hidden');
      window.scrollTo(0,0);

      try {
        currentUrl = atob(decodeURIComponent(encodedR));
        
        // MODO SEGURO: Sandbox ON (Bloquea publicidad ajena)
        viewer.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-pointer-lock allow-presentation');
        viewer.src = currentUrl;
        
        shield.style.display = 'block';
        unlockBtn.style.display = 'flex';

      } catch(e) {
        alert("Error al cargar.");
        closePlayer();
      }
    }

    function closePlayer() {
      viewer.src = ""; // Stop video
      viewer.removeAttribute('sandbox');
      document.getElementById('view-player').classList.add('hidden');
      document.getElementById('view-agenda').classList.remove('hidden');
    }

    function removeShield() {
      shield.style.display = 'none';
    }

    function desbloquearReproductor() {
      if(confirm("丘멆잺 쯇ANTALLA NEGRA?\n\nAl desbloquear, el video recargar치 sin filtro de anuncios.\n\n쮺ontinuar?")) {
        viewer.removeAttribute('sandbox');
        viewer.src = currentUrl;
        unlockBtn.style.display = 'none';
        shield.style.display = 'none';
      }
    }

    function toggleChat(btn) {
      const wrapper = document.getElementById('chat-wrapper');
      wrapper.classList.toggle('show');
      
      const icon = btn.querySelector('.arrow');
      if(wrapper.classList.contains('show')) {
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
        if(!chatLoaded) {
          chatFrame.src = "https://www3.cbox.ws/box/?boxid=3550648&boxtag=KQBTQs";
          chatLoaded = true;
        }
      } else {
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
      }
    }
  </script>

  <style>
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } from { opacity: 0; transform: translateY(10px); } }
  </style>
</body>
</html>
