<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JJFUTBOL - Ultra V4 Shield Edition</title>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --primary: #D4AF37;
            --primary-glow: rgba(212, 175, 55, 0.5);
            --bg-dark: #050508;
            --focus: #00ff88;
            --danger: #ff4444;
            --text: #ffffff;
            --glass: rgba(255, 255, 255, 0.05);
            --card-hover: rgba(212, 175, 55, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- SISTEMA DE CURSOR TV --- */
        #tv-cursor {
            position: absolute; width: 35px; height: 35px;
            background: url('https://cdn-icons-png.flaticon.com/512/61/61122.png');
            background-size: contain; background-repeat: no-repeat;
            z-index: 10000; pointer-events: none;
            transition: all 0.15s cubic-bezier(0.165, 0.84, 0.44, 1);
            display: none; filter: drop-shadow(0 0 10px var(--primary));
        }

        .focusable.focused {
            border: 2px solid var(--focus) !important;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
            transform: scale(1.04);
            background: var(--card-hover) !important;
            z-index: 500;
        }

        /* --- CABECERA --- */
        header {
            padding: 15px 25px; display: flex; justify-content: space-between; align-items: center;
            background: rgba(10, 10, 15, 0.95); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--glass); position: sticky; top: 0; z-index: 1000;
        }
        .logo-box img { height: 42px; filter: drop-shadow(0 0 5px var(--primary-glow)); }
        #live-clock { font-size: 20px; font-weight: 800; color: var(--primary); }
        #live-date { font-size: 10px; color: #666; text-transform: uppercase; letter-spacing: 1px; }

        .main-content { max-width: 1100px; margin: 0 auto; padding: 15px; }

        /* --- TABS --- */
        .tabs-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab {
            flex: 1; padding: 14px; border-radius: 14px; background: var(--glass);
            border: 1px solid transparent; color: #888; font-weight: 700;
            cursor: pointer; text-align: center; transition: 0.3s;
        }
        .tab.active { background: var(--primary); color: #000; box-shadow: 0 5px 15px var(--primary-glow); }

        .search-area { position: relative; margin-bottom: 25px; }
        .search-area input {
            width: 100%; padding: 16px 16px 16px 50px; background: #0f0f15;
            border: 1px solid #222; border-radius: 16px; color: white; font-size: 15px;
        }
        .search-area i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--primary); }

        /* --- LISTADO --- */
        .event-card {
            background: #111118; border: 1px solid var(--glass);
            border-radius: 22px; margin-bottom: 15px; transition: 0.3s; cursor: pointer;
            overflow: hidden;
        }
        .card-top { padding: 20px; display: flex; align-items: center; gap: 15px; }
        
        .time-badge {
            display: flex; flex-direction: column; align-items: center;
            min-width: 70px; border-right: 1px solid #222; padding-right: 15px;
        }
        .time-now { font-size: 1.2rem; font-weight: 800; color: white; }
        .status-live { font-size: 10px; color: var(--focus); font-weight: 800; }

        .match-info { flex: 1; }
        .match-name { font-size: 16px; font-weight: 700; margin-bottom: 5px; color: #efefef; }
        .league-info { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #666; }
        .league-img { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }

        .drawer {
            display: none; padding: 15px; background: rgba(0,0,0,0.5);
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; 
            border-top: 1px solid #222;
        }
        .signal-btn {
            padding: 12px; background: #1a1a25; border: 1px solid #333; border-radius: 12px;
            color: white; font-size: 12px; font-weight: 700; text-align: center; text-decoration: none;
        }

        /* --- REPRODUCTOR V4 --- */
        #view-player { display: none; padding-top: 10px; }
        .player-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .back-btn {
            width: 48px; height: 48px; border-radius: 50%; background: var(--glass);
            border: 1px solid var(--glass); color: white; display: flex; align-items: center; justify-content: center;
        }

        .video-box {
            position: relative; width: 100%; padding-bottom: 56.25%; background: #000;
            border-radius: 24px; overflow: hidden; border: 2px solid var(--primary);
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }
        .video-box iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        /* CONTROLES REPRODUCTOR */
        .player-bar {
            margin-top: 15px; display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px;
        }
        .p-btn {
            padding: 15px; border-radius: 15px; font-weight: 800; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 13px;
        }
        .btn-shield { background: #0a0a0a; border: 2px solid var(--primary); color: var(--primary); }
        .btn-shield.off { border-color: var(--danger); color: var(--danger); }
        .btn-chat { background: #111; color: white; border: 1px solid #333; }
        .btn-refresh { background: var(--glass); color: #fff; border: 1px solid #333; }

        /* --- CHAT LATERAL --- */
        #chat-panel {
            position: fixed; right: -100%; top: 0; width: 380px; height: 100%;
            background: #08080a; z-index: 5000; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-left: 2px solid var(--primary); padding: 20px;
        }
        #chat-panel.active { right: 0; }
        .chat-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close-chat { background: #ff4444; border: none; color: white; padding: 10px 15px; border-radius: 10px; font-weight: 800; }

        /* LOADING */
        .loading-skel { height: 100px; background: #111; border-radius: 20px; margin-bottom: 15px; position: relative; overflow: hidden; }
        .loading-skel::after {
            content: ""; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: slide 1.5s infinite;
        }
        @keyframes slide { to { left: 100%; } }

        @media (max-width: 600px) {
            #chat-panel { width: 90%; }
            .player-bar { grid-template-columns: 1fr; }
            .drawer { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="tv-cursor"></div>

    <header>
        <div class="logo-box">
            <img src="https://raw.githubusercontent.com/JJFUTBOL15/eventos/main/1762386751.png" alt="JJFUTBOL">
        </div>
        <div style="text-align: right;">
            <div id="live-clock">00:00:00</div>
            <div id="live-date">Cargando...</div>
        </div>
    </header>

    <div class="main-content">
        
        <div id="view-agenda">
            <div class="tabs-row">
                <div class="tab focusable active" onclick="changeDay(0, this)">HOY</div>
                <div class="tab focusable" onclick="changeDay(1, this)">MAÑANA</div>
            </div>

            <div class="search-area">
                <i class="fas fa-search"></i>
                <input type="text" id="app-search" class="focusable" placeholder="Buscar por equipo, liga o país...">
            </div>

            <div id="list-events">
                <div class="loading-skel"></div>
                <div class="loading-skel"></div>
                <div class="loading-skel"></div>
            </div>
        </div>

        <div id="view-player">
            <div class="player-header">
                <button class="back-btn focusable" onclick="exitPlayer()">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div>
                    <div id="current-match" style="font-weight: 800; font-size: 18px; color: var(--primary);">Cargando Evento...</div>
                    <div id="protection-status" style="font-size: 10px; color: var(--focus);">ESCUDO ANTI-ADS ACTIVADO</div>
                </div>
            </div>

            <div class="video-box">
                <iframe id="player-iframe" src="" allowfullscreen sandbox="allow-forms allow-scripts allow-same-origin allow-pointer-lock"></iframe>
            </div>

            <div class="player-bar">
                <button class="p-btn btn-shield focusable" onclick="toggleShield()">
                    <i class="fas fa-shield-alt"></i> MODO PROTECCIÓN: <span id="shield-txt">ON</span>
                </button>
                <button class="p-btn btn-chat focusable" onclick="toggleChat(true)">
                    <i class="fas fa-comments"></i> CHAT
                </button>
                <button class="p-btn btn-refresh focusable" onclick="refreshStream()">
                    <i class="fas fa-sync-alt"></i> RECARGAR
                </button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                <a href="https://t.me/+gFVPJ0M9Moo3YTEx" class="signal-btn focusable" style="background:#0088cc; border:none; padding:15px;">TELEGRAM</a>
                <a href="https://jjmovies.lat" class="signal-btn focusable" style="background:var(--primary); color:black; border:none; padding:15px;">JJMOVIES</a>
            </div>
        </div>

    </div>

    <div id="chat-panel">
        <div class="chat-head">
            <div style="font-weight: 800; color: var(--primary); font-size: 18px;">CHAT JJFUTBOL</div>
            <button class="close-chat focusable" onclick="toggleChat(false)">CERRAR <i class="fas fa-times"></i></button>
        </div>
        <iframe id="chat-frame" width="100%" height="80%" frameborder="0" src=""></iframe>
        <div style="margin-top:20px; font-size:11px; color:#444; text-align:center;">Respeta a la comunidad al comentar</div>
    </div>

    <script>
        const APIS = [
            { url: "https://goolhd.com/agenda.json", img: "https://img.goolhd.com" },
            { url: "https://pltvhd.com/diaries.json", img: "https://cdn.pltvhd.com" }
        ];

        let MASTER_DATA = [];
        let dayOffset = 0;
        let cursorIdx = 0;
        let tvMode = false;
        let activeR = "";
        let shieldActive = true;

        $(document).ready(() => {
            startTime();
            setInterval(startTime, 1000);
            loadMaster();

            // Navegación TV
            $(window).on("keydown", (e) => {
                if(!tvMode) { tvMode = true; $("#tv-cursor").fadeIn(); }
                handleTV(e.which);
            });

            // Buscador
            $("#app-search").on("input", function() {
                doSearch($(this).val());
            });
        });

        function startTime() {
            const now = luxon.DateTime.now().setZone("America/Lima");
            $("#live-clock").text(now.toFormat("HH:mm:ss"));
            $("#live-date").text(now.setLocale('es').toFormat("cccc, dd 'de' MMMM"));
        }

        async function loadMaster() {
            try {
                const calls = APIS.map(a => fetch(a.url + "?z=" + Date.now()).then(r => r.json()));
                const results = await Promise.all(calls);
                
                MASTER_DATA = [];
                results.forEach((res, i) => {
                    if(res.data) {
                        const items = res.data.map(item => ({ ...item, base: APIS[i].img }));
                        MASTER_DATA = MASTER_DATA.concat(items);
                    }
                });

                MASTER_DATA.sort((a,b) => (a.attributes.diary_hour || "").localeCompare(b.attributes.diary_hour || ""));
                renderUI();
            } catch (err) {
                $("#list-events").html('<div style="text-align:center; padding:50px;">Servidores fuera de línea. Reintente.</div>');
            }
        }

        function renderUI(filterData = null) {
            const data = filterData || MASTER_DATA;
            const target = luxon.DateTime.now().setZone("America/Lima").plus({ days: dayOffset }).toISODate();
            const filtered = data.filter(ev => ev.attributes.date_diary === target);
            
            let html = "";
            if(filtered.length === 0) {
                html = '<div style="text-align:center; padding:50px; color:#555;">No hay partidos programados.</div>';
            } else {
                filtered.forEach(ev => {
                    const attr = ev.attributes;
                    const time = fixTime(attr.diary_hour);
                    const flag = attr.country?.data?.attributes?.image?.data?.attributes?.url 
                                ? ev.base + attr.country.data.attributes.image.data.attributes.url 
                                : "https://raw.githubusercontent.com/JJFUTBOL15/eventos/main/1762386751.png";

                    let channels = "";
                    const embeds = attr.embeds?.data || [];
                    embeds.forEach(l => {
                        const r = l.attributes.embed_iframe.split("?r=")[1]?.split("&")[0];
                        if(r) {
                            channels += `<div class="signal-btn focusable" onclick="startPlay('${r}', '${attr.diary_description.replace(/'/g, "")}')"><i class="fas fa-play"></i> ${l.attributes.embed_name}</div>`;
                        }
                    });

                    html += `
                        <div class="event-card focusable" onclick="toggleDrawer(this)">
                            <div class="card-top">
                                <div class="time-badge">
                                    <span class="time-now">${time}</span>
                                    <span class="status-live">HD</span>
                                </div>
                                <div class="match-info">
                                    <div class="match-name">${attr.diary_description}</div>
                                    <div class="league-info">
                                        <img src="${flag}" class="league-img">
                                        <span>${attr.country?.data?.attributes?.name || 'Internacional'}</span>
                                    </div>
                                </div>
                                <i class="fas fa-chevron-down" style="color:#333"></i>
                            </div>
                            <div class="drawer">${channels || '<p style="font-size:10px; opacity:0.5;">Cargando señales...</p>'}</div>
                        </div>
                    `;
                });
            }
            $("#list-events").html(html);
            cursorIdx = 0;
            refreshTV();
        }

        // --- MANEJO TV ---
        function handleTV(key) {
            const focusables = $(".focusable:visible");
            if(key == 40) cursorIdx++; // Down
            if(key == 38) cursorIdx--; // Up
            if(key == 13) focusables.eq(cursorIdx).click(); // OK

            if(cursorIdx < 0) cursorIdx = 0;
            if(cursorIdx >= focusables.length) cursorIdx = focusables.length - 1;

            refreshTV();
        }

        function refreshTV() {
            const focusables = $(".focusable:visible");
            $(".focusable").removeClass("focused");
            const current = focusables.eq(cursorIdx);
            current.addClass("focused");

            if(current.length && tvMode) {
                const r = current[0].getBoundingClientRect();
                $("#tv-cursor").css({ top: (r.top + window.scrollY + 10) + "px", left: (r.left - 25) + "px" });
                current[0].scrollIntoView({ behavior: "smooth", block: "center" });
            }
        }

        // --- FUNCIONES LOGICA ---
        function changeDay(offset, el) {
            dayOffset = offset;
            $(".tab").removeClass("active");
            $(el).addClass("active");
            renderUI();
        }

        function toggleDrawer(el) {
            const d = $(el).find(".drawer");
            $(".drawer").not(d).slideUp(200);
            d.slideToggle(200, () => refreshTV());
        }

        function startPlay(r, title) {
            activeR = r;
            const url = atob(decodeURIComponent(r));
            $("#view-agenda").hide();
            $("#view-player").show();
            $("#player-iframe").attr("src", url);
            $("#current-match").text(title);
            window.scrollTo(0,0);
            cursorIdx = 0;
            refreshTV();
        }

        function exitPlayer() {
            $("#player-iframe").attr("src", "");
            $("#view-player").hide();
            $("#view-agenda").show();
            toggleChat(false);
            refreshTV();
        }

        // --- EL NUEVO SISTEMA DE ESCUDO ---
        function toggleShield() {
            shieldActive = !shieldActive;
            const iframe = $("#player-iframe");
            const btn = $(".btn-shield");
            const status = $("#protection-status");

            if(shieldActive) {
                btn.removeClass("off").html('<i class="fas fa-shield-alt"></i> MODO PROTECCIÓN: ON');
                status.text("ESCUDO ANTI-ADS ACTIVADO").css("color", "var(--focus)");
                iframe.attr("sandbox", "allow-forms allow-scripts allow-same-origin allow-pointer-lock");
            } else {
                btn.addClass("off").html('<i class="fas fa-shield-virus"></i> MODO PROTECCIÓN: OFF');
                status.text("ATENCIÓN: PROTECCIÓN DESACTIVADA").css("color", "var(--danger)");
                iframe.removeAttr("sandbox");
            }
            refreshStream();
        }

        function refreshStream() {
            if(activeR) {
                const url = atob(decodeURIComponent(activeR));
                $("#player-iframe").attr("src", "about:blank");
                setTimeout(() => $("#player-iframe").attr("src", url), 200);
            }
        }

        function toggleChat(show) {
            const p = $("#chat-panel");
            const f = $("#chat-frame");
            if(show) {
                p.addClass("active");
                if(!f.attr("src")) f.attr("src", "https://www3.cbox.ws/box/?boxid=3550648&boxtag=KQBTQs");
            } else {
                p.removeClass("active");
            }
        }

        function fixTime(h) {
            if(!h) return "--:--";
            let dt = luxon.DateTime.fromFormat(h, "HH:mm", { zone: "America/Lima" });
            return dt.isValid ? dt.toLocal().toFormat("HH:mm") : h;
        }

        function doSearch(q) {
            const term = q.toLowerCase();
            const res = MASTER_DATA.filter(ev => 
                ev.attributes.diary_description.toLowerCase().includes(term)
            );
            renderUI(res);
        }
    </script>
</body>
</html>
