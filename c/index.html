<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0e1129">
  <title>JJFUTBOL CHAMPIONS</title>
  
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <style>
    /* --- TEMA CHAMPIONS LEAGUE (NEÓN & OSCURO) --- */
    :root {
      --bg-deep: #050507;
      --ucl-blue: #111a47;
      --neon-cyan: #00f0ff;
      --neon-pink: #ff0055;
      --text-main: #ffffff;
      --card-bg: rgba(17, 26, 50, 0.9);
      --border-glow: rgba(0, 240, 255, 0.3);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-deep);
      color: var(--text-main);
      margin: 0; padding: 0; min-height: 100vh; overflow-x: hidden;
      background-image: radial-gradient(circle at 50% 0%, #1a237e 0%, #000000 80%);
    }

    /* ESTRELLAS DE FONDO */
    .stars {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1;
      background-image: radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px);
      background-size: 550px 550px; opacity: 0.15;
    }

    .hidden { display: none !important; }

    /* HEADER */
    header {
      padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;
      background: rgba(5, 5, 10, 0.95); backdrop-filter: blur(20px);
      position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255,255,255,0.1);
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    .brand { display: flex; align-items: center; gap: 12px; }
    .logo { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--neon-cyan); box-shadow: 0 0 15px var(--neon-cyan); object-fit: cover; }
    .title { font-family: 'Rajdhani', sans-serif; font-size: 22px; font-weight: 700; color: white; line-height: 1; }
    .title span { color: var(--neon-cyan); font-size: 11px; display: block; letter-spacing: 2px; }
    .refresh-btn { width: 38px; height: 38px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s; }
    .refresh-btn:active { transform: rotate(180deg); background: var(--neon-cyan); color: black; }

    /* CONTENEDOR */
    .container { max-width: 800px; margin: 0 auto; padding: 20px 15px 100px; }

    /* BUSCADOR */
    .search-box { position: relative; margin-bottom: 20px; }
    .search-box input {
      width: 100%; padding: 14px 20px 14px 45px;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px; color: white; font-family: 'Inter'; font-size: 14px; outline: none;
    }
    .search-box input:focus { border-color: var(--neon-cyan); background: rgba(0, 240, 255, 0.05); }
    .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--neon-cyan); }

    /* FILTROS */
    .filters { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 25px; scrollbar-width: none; }
    .chip {
      padding: 10px 20px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 30px; font-size: 12px; font-weight: 600; color: #aaa; white-space: nowrap; cursor: pointer;
      font-family: 'Rajdhani', sans-serif; letter-spacing: 1px; transition: 0.3s;
    }
    .chip.active { background: var(--neon-cyan); color: black; border-color: var(--neon-cyan); box-shadow: 0 0 15px rgba(0, 240, 255, 0.4); font-weight: 700; }
    .chip.live-mode.active { background: var(--neon-pink); color: white; border-color: var(--neon-pink); box-shadow: 0 0 15px rgba(255, 0, 85, 0.4); }

    /* LISTA DE PARTIDOS */
    #event-list { display: flex; flex-direction: column; gap: 15px; }

    .card {
      background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 16px; overflow: hidden; position: relative; transition: transform 0.2s;
      backdrop-filter: blur(10px);
    }
    .card:active { transform: scale(0.98); }
    .card.live-on { border-color: var(--neon-pink); box-shadow: 0 0 15px rgba(255, 0, 85, 0.15); }

    .fav-btn {
      position: absolute; top: 0; right: 0; width: 50px; height: 50px;
      display: flex; align-items: center; justify-content: center;
      color: rgba(255,255,255,0.2); z-index: 10; font-size: 18px; cursor: pointer;
    }
    .fav-btn.active { color: var(--neon-pink); animation: heartPop 0.3s ease; }
    @keyframes heartPop { 50% { transform: scale(1.3); } }

    .card-header { padding: 18px; display: grid; grid-template-columns: 60px 1fr 24px; align-items: center; gap: 15px; }
    
    .time-badge {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: rgba(0,0,0,0.3); border-radius: 8px; padding: 8px 0; border: 1px solid rgba(255,255,255,0.1);
      font-family: 'Rajdhani', sans-serif;
    }
    .time-badge span { font-weight: 700; font-size: 15px; color: white; }
    .time-badge small { font-size: 10px; color: #888; font-weight: 600; margin-top: 2px; }
    .card.live-on .time-badge { background: var(--neon-pink); border-color: var(--neon-pink); }
    .card.live-on .time-badge small { color: white; }

    .match-info { display: flex; align-items: center; gap: 12px; overflow: hidden; }
    .match-img { width: 32px; height: 32px; object-fit: contain; }
    .match-title { font-family: 'Rajdhani', sans-serif; font-size: 16px; font-weight: 700; color: white; line-height: 1.2; text-transform: uppercase; }
    .league-name { font-size: 10px; color: var(--neon-cyan); font-weight: 600; margin-top: 4px; letter-spacing: 1px; }

    .expand-icon { color: var(--neon-cyan); transition: 0.3s; font-size: 14px; }
    .card.open .expand-icon { transform: rotate(180deg); }

    /* BOTONES DE CANALES */
    .channels-box {
      max-height: 0; overflow: hidden; transition: max-height 0.3s ease;
      background: rgba(0,0,0,0.3); border-top: 1px solid rgba(255,255,255,0.05);
    }
    .channels-grid { padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    .btn-channel {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px; color: white; padding: 12px; font-size: 11px; font-weight: 700;
      display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer;
      font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 0.5px;
      position: relative; overflow: hidden;
    }
    .btn-channel::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--neon-cyan); }
    .btn-channel:active { background: var(--neon-cyan); color: black; }

    /* --- REPRODUCTOR V18 (FORZADO) --- */
    #player-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: black; z-index: 9999; display: flex; flex-direction: column;
      transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    #player-overlay.visible { transform: translateY(0); }

    .player-nav {
      padding: 15px 20px; display: flex; align-items: center; gap: 15px;
      background: linear-gradient(to bottom, #000, transparent); position: absolute; top: 0; width: 100%; z-index: 50;
    }
    .btn-back {
      width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center;
      color: white; border: none; font-size: 18px; cursor: pointer;
    }

    .video-stage { flex: 1; display: flex; flex-direction: column; justify-content: center; position: relative; }
    .video-container { width: 100%; padding-top: 56.25%; position: relative; background: #000; box-shadow: 0 0 50px rgba(0, 240, 255, 0.15); }
    iframe#viewer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

    /* ESCUDO ANTI-ADS NEÓN */
    #ad-shield {
      position: absolute; inset: 0; z-index: 20; background: #000;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.5s;
    }
    .loading-text { font-family: 'Rajdhani', sans-serif; font-size: 16px; font-weight: 700; color: var(--neon-cyan); letter-spacing: 2px; margin-bottom: 15px; }
    .loader-bar { width: 200px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; }
    .loader-progress { height: 100%; background: var(--neon-cyan); width: 0%; box-shadow: 0 0 15px var(--neon-cyan); transition: width 0.1s linear; }

    #unlock-btn {
      position: absolute; top: 70px; right: 20px; z-index: 60;
      background: rgba(255, 0, 85, 0.3); border: 1px solid var(--neon-pink); color: white;
      padding: 8px 16px; border-radius: 20px; font-size: 11px; font-weight: 700;
      display: none; cursor: pointer; backdrop-filter: blur(5px);
    }

    /* INFO & CHAT */
    .player-info { padding: 25px 20px; background: #050507; flex: 1; border-top: 1px solid rgba(255,255,255,0.1); }
    .event-title { font-family: 'Rajdhani', sans-serif; font-size: 20px; font-weight: 700; color: white; margin-bottom: 20px; line-height: 1.2; text-transform: uppercase; }
    
    .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
    .btn-link {
      padding: 12px; background: rgba(255,255,255,0.05); border-radius: 12px;
      text-align: center; color: white; text-decoration: none; font-size: 12px; font-weight: 700;
      border: 1px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; gap: 8px;
    }

    .chat-container { border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; overflow: hidden; background: #0e1129; }
    .chat-header { padding: 12px 15px; background: rgba(255,255,255,0.03); font-size: 12px; font-weight: 700; color: var(--neon-cyan); display: flex; justify-content: space-between; cursor: pointer; }
    .chat-content { height: 0; transition: height 0.3s; }
    .chat-content.open { height: 350px; }

  </style>
</head>
<body>

  <div class="stars"></div>

  <header>
    <div class="brand">
      <img src="https://raw.githubusercontent.com/JJFUTBOL15/eventos/main/1762386751.png" alt="Logo" class="logo">
      <div class="title">JJFUTBOL <span>CHAMPIONS</span></div>
    </div>
    <div class="refresh-btn" onclick="initApp()"><i class="fas fa-rotate-right"></i></div>
  </header>

  <div id="view-agenda" class="view-section">
    <div class="container">
      
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Buscar equipo o torneo...">
      </div>

      <div class="filters">
        <div class="chip active" onclick="filterEvents('all', this)">TODOS</div>
        <div class="chip live-mode" onclick="filterEvents('live', this)">● EN VIVO</div>
        <div class="chip" onclick="filterEvents('fav', this)">♥ FAVORITOS</div>
      </div>

      <div style="margin-bottom: 25px; border-radius: 16px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);">
        <div style="background: linear-gradient(90deg, #090c24, #1a225e); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-family:'Rajdhani'; font-weight:700; color:white; font-size:16px;">JJMOVIES 2026</div>
            <div style="color:var(--neon-cyan); font-size:11px; margin-top:4px;">PELÍCULAS GRATIS</div>
          </div>
          <a href="https://jjmovies.lat" target="_blank" style="background:white; color:black; font-weight:800; font-size:11px; padding:8px 16px; border-radius: 20px; text-decoration:none; font-family:'Rajdhani';">ENTRAR</a>
        </div>
      </div>

      <div id="matches-container">
        <div style="text-align:center; padding:40px; color:#666;">Cargando eventos...</div>
      </div>

    </div>
  </div>

  <div id="player-overlay">
    <div class="player-nav">
      <button class="btn-back" onclick="closePlayer()"><i class="fas fa-arrow-left"></i></button>
      <span style="font-weight:700; font-size:14px; color:white; margin-left:10px;">EN VIVO</span>
    </div>

    <div class="video-stage">
      <div class="video-container">
        
        <div id="unlock-btn" onclick="forceUnlock()">
          <i class="fas fa-lock-open"></i> DESBLOQUEAR / OPCIÓN 2
        </div>
        
        <div id="ad-shield">
          <div class="loading-text" id="shield-txt">INICIANDO SISTEMA...</div>
          <div class="loader-bar"><div class="loader-progress" id="shield-prog"></div></div>
        </div>
        
        <iframe id="viewer" src="" allowfullscreen allow="autoplay; encrypted-media"></iframe>
      </div>
    </div>

    <div class="player-info">
      <div class="event-title" id="player-title">Evento</div>
      
      <div class="btn-row">
        <a href="https://t.me/+EPyKMpHXlv5lMmYx" target="_blank" class="btn-link" style="background:#229ED9; border-color:#229ED9;"><i class="fab fa-telegram-plane"></i> TELEGRAM</a>
        <a href="https://jjmovies.lat" target="_blank" class="btn-link" style="background:var(--neon-cyan); color:black; border-color:var(--neon-cyan);"><i class="fas fa-film"></i> CINE</a>
      </div>

      <div class="chat-container">
        <div class="chat-header" onclick="toggleChat()">
          <span>CHAT GLOBAL</span> <i class="fas fa-chevron-down"></i>
        </div>
        <div class="chat-content" id="chat-box">
          <iframe id="chat-frame" width="100%" height="100%" frameborder="0" style="background:transparent;"></iframe>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- DATOS EMBEBIDOS (TU JSON COMPLETO) ---
    const MANUAL_DATA = {"data":[{"attributes":{"diary_description":"Tour El Salvador 2026: Etapa #4","diary_hour":"11:00am","league_name":"CICLISMO","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Tour El Salvador 2026: Etapa #4","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 4","embed_iframe":"https://bestleague.world/en-vivo/espn-4/"}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Galatasaray vs. Atlético Madrid","diary_hour":"12:45pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Galatasaray vs. Atlético Madrid","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 1 CO","embed_iframe":"https://bestleague.world/en-vivo/espn-cope/"}},{"attributes":{"embed_name":"FOX Sports 1","embed_iframe":"https://bestleague.world/en-vivo/fox-sports/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5MQ=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Qarabağ vs. Eintracht Frankfurt","diary_hour":"12:45pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Qarabağ vs. Eintracht Frankfurt","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 2","embed_iframe":"https://bestleague.world/en-vivo/espn-2/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5Mg=="}},{"attributes":{"embed_name":"MAX","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09bWF4MQ=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Olympique Marseille vs. Liverpool","diary_hour":"3:00pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Olympique Marseille vs. Liverpool","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 5","embed_iframe":"https://bestleague.world/en-vivo/espn-5"}},{"attributes":{"embed_name":"FOX Sports 1","embed_iframe":"https://bestleague.world/en-vivo/fox-sports/"}},{"attributes":{"embed_name":"MAX","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09bWF4Mw=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Bayern München vs. Union Saint-Gilloise","diary_hour":"3:00pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Bayern München vs. Union Saint-Gilloise","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 3 AR","embed_iframe":"https://bestleague.world/en-vivo/espn-3-ar/"}},{"attributes":{"embed_name":"ESPN 1 CO","embed_iframe":"https://bestleague.world/en-vivo/espn-co/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5MQ=="}},{"attributes":{"embed_name":"Paramount+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cGFyYW1vdW50Mg=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Newcastle United vs. PSV","diary_hour":"3:00pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Newcastle United vs. PSV","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 6","embed_iframe":"https://bestleague.world/en-vivo/espn-6/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5Ng=="}},{"attributes":{"embed_name":"MAX","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09bWF4NA=="}},{"attributes":{"embed_name":"Paramount+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cGFyYW1vdW50NQ=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Chelsea vs. Paphos","diary_hour":"3:00pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Chelsea vs. Paphos","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 3 CO","embed_iframe":"https://bestleague.world/en-vivo/espn-3-cope/"}},{"attributes":{"embed_name":"ESPN 1 AR","embed_iframe":"https://bestleague.world/en-vivo/espn-ar/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5Mw=="}},{"attributes":{"embed_name":"MAX","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09bWF4Mg=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Juventus vs. Benfica","diary_hour":"3:00pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Juventus vs. Benfica","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 7","embed_iframe":"https://bestleague.world/en-vivo/espn-7/"}},{"attributes":{"embed_name":"FOX Sports 2","embed_iframe":"https://bestleague.world/en-vivo/fox-sports-2/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5Nw=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Atalanta vs. Athletic Club","diary_hour":"3:00pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Atalanta vs. Athletic Club","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 4","embed_iframe":"https://bestleague.world/en-vivo/espn-4/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5NA=="}}]}}},{"attributes":{"diary_description":"UEFA Champions League: Slavia Praha vs. Barcelona","diary_hour":"3:00pm","league_name":"CHA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/5.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"UEFA Champions League: Slavia Praha vs. Barcelona","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 2 AR","embed_iframe":"https://bestleague.world/en-vivo/espn-2-arco/"}},{"attributes":{"embed_name":"Paramount+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cGFyYW1vdW50MQ=="}}]}}},{"attributes":{"diary_description":"Championship: Stoke City vs. Middlesbrough","diary_hour":"3:00pm","league_name":"ENG","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/61.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Championship: Stoke City vs. Middlesbrough","embed_iframe":"#"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5OA=="}}]}}},{"attributes":{"diary_description":"Campeonato Carioca: Maricá vs. Bangu","diary_hour":"3:00pm","league_name":"BRA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/79.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Campeonato Carioca: Maricá vs. Bangu","embed_iframe":"#"}},{"attributes":{"embed_name":"Premiere 2 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cHJlbWllcmUy"}},{"attributes":{"embed_name":"Premiere 2 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9iZXN0bGVhZ3VlLndvcmxkL21wZGsvP2dldD1hSFIwY0hNNkx5OWhZbU16YjNKM1lXRmhZV0ZoWVdGdFpUWTFOVFZvTTJJMllXWTBOQzV2ZEhSaUxteHBkbVV1WTJZdWQzY3VZV2wyTFdOa2JpNXVaWFF2WjNKMUxXNXBkSEp2TDJ4cGRtVXZZMnhwWlc1MGN5OWtZWE5vTDJWdVl5OXZlVFp5Y0RCcWQyMW1MMjkxZEM5Mk1TODFPREJsWTJZeE1tSmhaREkwT1RjNVltRm1PR1JrT1RrelpHTmxNRFV6WlM5alpXNWpMbTF3WkE9PSZrZXk9T1dSak5EQTBOakJqT1RNd09EZGhaV0U0TkdRMk16RTFaakE0WldOaU5qUT0ma2V5Mj1aalk1WXpoa05EWXlOR1prWkdabU5HTmhPRGxpWkRCaU16RmlaR00wWVRjPQ=="}}]}}},{"attributes":{"diary_description":"Supercopa de Chile: Coquimbo Unido vs. Deportes Limache","diary_hour":"5:00pm","league_name":"CH","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Supercopa de Chile: Coquimbo Unido vs. Deportes Limache","embed_iframe":"#"}},{"attributes":{"embed_name":"TNT Sports Premium","embed_iframe":"https://bestleague.world/en-vivo/tnt-sports/"}},{"attributes":{"embed_name":"MAX","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09bWF4NQ=="}}]}}},{"attributes":{"diary_description":"Campeonato Carioca: Botafogo vs. Volta Redonda","diary_hour":"5:00pm","league_name":"BRA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/79.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Campeonato Carioca: Botafogo vs. Volta Redonda","embed_iframe":"#"}},{"attributes":{"embed_name":"Premiere 1 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cHJlbWllcmUx"}},{"attributes":{"embed_name":"Premiere 1 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9iZXN0bGVhZ3VlLndvcmxkL21wZGsvP2dldD1hSFIwY0hNNkx5OWhZbU16YjNKM1lXRmhZV0ZoWVdGdGFIQjFhVGQzYkc1dFpuRm5hQzV2ZEhSaUxteHBkbVV1WTJZdWQzY3VZV2wyTFdOa2JpNXVaWFF2WjNKMUxXNXBkSEp2TDJ4cGRtVXZZMnhwWlc1MGN5OWtZWE5vTDJWdVl5OXVaV3htZVhWamR6bGhMMjkxZEM5Mk1TODJabVppTW1Nek5qVmhaREUwWmpnNFlqRTFORFU1TVdKbFlqUXpaREZtTmk5alpXNWpMbTF3WkE9PSZrZXk9TlRaaU56bGpNVGM0TW1Jek1HVTJZalptWXprM00ySXdaVGhtWkRReE1EUT0ma2V5Mj1abUV6T0dGaFlUZzJOV0UxTjJWa1lUZGpOemMwTkRRMk9UZGlZVGhsWkRNPQ=="}}]}}},{"attributes":{"diary_description":"Campeonato Gaúcho: Internacional vs. Inter Santa Maria","diary_hour":"5:00pm","league_name":"BRA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/79.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Campeonato Gaúcho: Internacional vs. Inter Santa Maria","embed_iframe":"#"}},{"attributes":{"embed_name":"Sport TV1 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09c3BvcnR0dmJyMQ=="}},{"attributes":{"embed_name":"Premiere 3 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cHJlbWllcmUz"}},{"attributes":{"embed_name":"Premiere 3 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9iZXN0bGVhZ3VlLndvcmxkL21wZGsvP2dldD1hSFIwY0hNNkx5OWhZbU16YjNKM1lXRmhZV0ZoWVdGdGFIQjFhVGQzYkc1dFpuRm5hQzV2ZEhSaUxteHBkbVV1WTJZdWQzY3VZV2wyTFdOa2JpNXVaWFF2WjNKMUxXNXBkSEp2TDJ4cGRtVXZZMnhwWlc1MGN5OWtZWE5vTDJWdVl5ODJiMjV5Wm01cGVYSjVMMjkxZEM5Mk1TOW1Nak13Tmpsak5qRmtZbVkwWlRBd09Ea3dZVFF3WWpjd05XRTROREEzT1M5alpXNWpMbTF3WkE9PSZrZXk9WkRJelpqYzBNek0zT1RoaE5qVXlZVGRrTkdZMk56a3haRGxsTVRBek5tTT0ma2V5Mj1ORGswTW1WbFltUTFPVGhpTlRjeU4yTTFZMk0wT0RSall6WXlZalV5WlRnPQ=="}}]}}},{"attributes":{"diary_description":"Campeonato Paulista A1: Mirassol vs. RB Bragantino","diary_hour":"6:00pm","league_name":"BRA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/79.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Campeonato Paulista A1: Mirassol vs. RB Bragantino","embed_iframe":"#"}},{"attributes":{"embed_name":"MAX","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09bWF4MQ=="}}]}}},{"attributes":{"diary_description":"Amistoso: Colo-Colo vs. Peñarol","diary_hour":"7:00pm","league_name":"FUT","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Amistoso: Colo-Colo vs. Peñarol","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN Premium","embed_iframe":"https://bestleague.world/en-vivo/espn-premium/"}},{"attributes":{"embed_name":"Disney+","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09ZGlzbmV5MQ=="}}]}}},{"attributes":{"diary_description":"Australian Open 2026: Cobertura Internacional | En español","diary_hour":"7:00pm","league_name":"TE","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Australian Open 2026: Cobertura Internacional | En español","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 2","embed_iframe":"https://bestleague.world/en-vivo/espn-2/"}}]}}},{"attributes":{"diary_description":"Australian Open 2026: Cobertura Regional | En español","diary_hour":"7:00pm","league_name":"TE","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Australian Open 2026: Cobertura Regional | En español","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 3","embed_iframe":"https://bestleague.world/en-vivo/espn-3/"}}]}}},{"attributes":{"diary_description":"NBA: Cleveland Cavaliers vs. Charlotte Hornets","diary_hour":"7:00pm","league_name":"NBA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://bestleague.world/img/nba.svg"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"NBA: Cleveland Cavaliers vs. Charlotte Hornets","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 4","embed_iframe":"https://bestleague.world/en-vivo/espn-4/"}}]}}},{"attributes":{"diary_description":"Copa Argentina: Argentinos Juniors vs. Midland","diary_hour":"7:15pm","league_name":"AR","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Copa Argentina: Argentinos Juniors vs. Midland","embed_iframe":"#"}},{"attributes":{"embed_name":"TyC Sports","embed_iframe":"https://bestleague.world/en-vivo/tyc-sports/"}}]}}},{"attributes":{"diary_description":"Superliga de Colombia (Final 2/2): Santa Fe vs. Junior","diary_hour":"7:30pm","league_name":"COL","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Superliga de Colombia (Final 2/2): Santa Fe vs. Junior","embed_iframe":"#"}},{"attributes":{"embed_name":"Win+ Fútbol","embed_iframe":"https://bestleague.world/en-vivo/win-sports-premium/"}}]}}},{"attributes":{"diary_description":"Campeonato Mineiro: América Mineiro vs. Atlético Mineiro","diary_hour":"7:30pm","league_name":"BRA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/79.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Campeonato Mineiro: América Mineiro vs. Atlético Mineiro","embed_iframe":"#"}},{"attributes":{"embed_name":"Premiere 2 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cHJlbWllcmUy"}},{"attributes":{"embed_name":"Premiere 2 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9iZXN0bGVhZ3VlLndvcmxkL21wZGsvP2dldD1hSFIwY0hNNkx5OWhZbU16YjNKM1lXRmhZV0ZoWVdGdFpUWTFOVFZvTTJJMllXWTBOQzV2ZEhSaUxteHBkbVV1WTJZdWQzY3VZV2wyTFdOa2JpNXVaWFF2WjNKMUxXNXBkSEp2TDJ4cGRtVXZZMnhwWlc1MGN5OWtZWE5vTDJWdVl5OXZlVFp5Y0RCcWQyMW1MMjkxZEM5Mk1TODFPREJsWTJZeE1tSmhaREkwT1RjNVltRm1PR1JrT1RrelpHTmxNRFV6WlM5alpXNWpMbTF3WkE9PSZrZXk9T1dSak5EQTBOakJqT1RNd09EZGhaV0U0TkdRMk16RTFaakE0WldOaU5qUT0ma2V5Mj1aalk1WXpoa05EWXlOR1prWkdabU5HTmhPRGxpWkRCaU16RmlaR00wWVRjPQ=="}}]}}},{"attributes":{"diary_description":"Campeonato Carioca: Flamengo vs. Vasco da Gama","diary_hour":"7:30pm","league_name":"BRA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/79.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Campeonato Carioca: Flamengo vs. Vasco da Gama","embed_iframe":"#"}},{"attributes":{"embed_name":"Premiere 1 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cHJlbWllcmUx"}},{"attributes":{"embed_name":"Premiere 1 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9iZXN0bGVhZ3VlLndvcmxkL21wZGsvP2dldD1hSFIwY0hNNkx5OWhZbU16YjNKM1lXRmhZV0ZoWVdGdGFIQjFhVGQzYkc1dFpuRm5hQzV2ZEhSaUxteHBkbVV1WTJZdWQzY3VZV2wyTFdOa2JpNXVaWFF2WjNKMUxXNXBkSEp2TDJ4cGRtVXZZMnhwWlc1MGN5OWtZWE5vTDJWdVl5OXVaV3htZVhWamR6bGhMMjkxZEM5Mk1TODJabVppTW1Nek5qVmhaREUwWmpnNFlqRTFORFU1TVdKbFlqUXpaREZtTmk5alpXNWpMbTF3WkE9PSZrZXk9TlRaaU56bGpNVGM0TW1Jek1HVTJZalptWXprM00ySXdaVGhtWkRReE1EUT0ma2V5Mj1abUV6T0dGaFlUZzJOV0UxTjJWa1lUZGpOemMwTkRRMk9UZGlZVGhsWkRNPQ=="}}]}}},{"attributes":{"diary_description":"Campeonato Gaúcho: Guarany de Bagé vs. Grêmio","diary_hour":"7:30pm","league_name":"BRA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"//bestleague.world/jr/79.png"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Campeonato Gaúcho: Guarany de Bagé vs. Grêmio","embed_iframe":"#"}},{"attributes":{"embed_name":"Premiere 3 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9zdHJlYW10cGNsb3VkLmNvbS9nbG9iYWwxLnBocD9zdHJlYW09cHJlbWllcmUz"}},{"attributes":{"embed_name":"Premiere 3 BR","embed_iframe":"/eventos/?r=aHR0cHM6Ly9iZXN0bGVhZ3VlLndvcmxkL21wZGsvP2dldD1hSFIwY0hNNkx5OWhZbU16YjNKM1lXRmhZV0ZoWVdGdGFIQjFhVGQzYkc1dFpuRm5hQzV2ZEhSaUxteHBkbVV1WTJZdWQzY3VZV2wyTFdOa2JpNXVaWFF2WjNKMUxXNXBkSEp2TDJ4cGRtVXZZMnhwWlc1MGN5OWtZWE5vTDJWdVl5ODJiMjV5Wm01cGVYSjVMMjkxZEM5Mk1TOW1Nak13Tmpsak5qRmtZbVkwWlRBd09Ea3dZVFF3WWpjd05XRTROREEzT1M5alpXNWpMbTF3WkE9PSZrZXk9WkRJelpqYzBNek0zT1RoaE5qVXlZVGRrTkdZMk56a3haRGxsTVRBek5tTT0ma2V5Mj1ORGswTW1WbFltUTFPVGhpTlRjeU4yTTFZMk0wT0RSall6WXlZalV5WlRnPQ=="}}]}}},{"attributes":{"diary_description":"NBA: Oklahoma City Thunder vs. Milwaukee Bucks","diary_hour":"9:30pm","league_name":"NBA","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://bestleague.world/img/nba.svg"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"NBA: Oklahoma City Thunder vs. Milwaukee Bucks","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 4","embed_iframe":"https://bestleague.world/en-vivo/espn-4/"}}]}}},{"attributes":{"diary_description":"Australian Open 2026: Cobertura Internacional | En español","diary_hour":"3:00am","league_name":"TE","country":{"data":{"attributes":{"image":{"data":{"attributes":{"url":"https://via.placeholder.com/40?text=TV"}}}}}},"embeds":{"data":[{"attributes":{"embed_name":"Australian Open 2026: Cobertura Internacional | En español","embed_iframe":"#"}},{"attributes":{"embed_name":"ESPN 2","embed_iframe":"https://bestleague.world/en-vivo/espn-2/"}}]}}}]};

    const API_URLS = [
      { url: "https://a.ftvhd.com/diaries.json", base: "https://img.futbolonlinehd.com" },
      { url: "https://golazoplay.com/agenda.json?v=1.0", base: "https://img.golazoplay.com" }
    ];
    let favs = JSON.parse(localStorage.getItem('jj_ucl_favs') || '[]');

    $(document).ready(() => {
      initApp();
      
      $('#searchInput').on('keyup', function() {
        const val = $(this).val().toLowerCase();
        $('.card').toggle(function() {
          return $(this).text().toLowerCase().indexOf(val) > -1;
        });
      });

      $(document).on('click', '.card', function(e) {
        if($(e.target).closest('.fav-btn, .btn-channel').length) return;
        $('.card').not(this).removeClass('open').find('.channels-box').slideUp(200);
        $(this).toggleClass('open').find('.channels-box').slideToggle(200);
      });

      // ZONA SEGURA DE CLIC (V18)
      $(document).on('click', '.btn-channel', function(e) {
        e.stopPropagation();
        const b64 = $(this).attr('data-link');
        const title = $(this).attr('data-title');
        playCh(b64, title);
      });
    });

    async function initApp() {
      $('#matches-container').empty();
      $('#matches-container').html('<div style="text-align:center; padding:40px; color:#aaa;">Cargando...</div>');
      
      let allEvents = [];

      try {
        const reqs = API_URLS.map(api => fetch(api.url + "?t=" + Date.now()).then(r=>r.json()).then(d => d.data.map(i => ({...i, _base: api.base}))).catch(e=>[]));
        const res = await Promise.all(reqs);
        allEvents = res.flat();
      } catch(e) {}

      // Mezclar datos MANUALES + APIS
      if (MANUAL_DATA && MANUAL_DATA.data) {
        const manualItems = MANUAL_DATA.data.map(i => ({...i, _base: ""}));
        allEvents = [...manualItems, ...allEvents];
      }

      // Filtrar duplicados
      const unique = [];
      const seen = new Set();
      allEvents.forEach(ev => {
        const k = (ev.attributes.diary_description || "") + (ev.attributes.diary_hour || "");
        if(!seen.has(k)) { seen.add(k); unique.push(ev); }
      });

      // Ordenar (Intento simple por hora)
      unique.sort((a,b) => {
        const ha = a.attributes.diary_hour || "00:00";
        const hb = b.attributes.diary_hour || "00:00";
        // Convertir PM/AM a 24h aproximado para ordenar
        const parseTime = (t) => {
           if(t.includes("pm") && !t.startsWith("12")) return t.replace("pm",""); // Simplificacion
           return t; 
        };
        return parseTime(ha).localeCompare(parseTime(hb));
      });

      render(unique);
    }

    function render(list) {
      const container = $('#matches-container');
      container.empty();

      if(list.length === 0) {
        container.html('<div style="text-align:center; padding:40px; color:#666;">Sin eventos.</div>');
        return;
      }

      list.forEach(item => {
        const attr = item.attributes;
        const id = btoa(encodeURIComponent(attr.diary_description + attr.diary_hour)).replace(/=/g, '');
        const isFav = favs.includes(id);

        let time = attr.diary_hour;
        let isLive = false;
        // Detección simple de "En Vivo" (Mejorable)
        if(time.toLowerCase().includes("vivo") || time.includes("pm")) {
           // isLive = true; // Descomentar para probar visual
        }

        let img = "https://via.placeholder.com/40?text=L";
        if(attr.league?.data?.attributes?.image?.data?.attributes?.url) {
          img = item._base + attr.league.data.attributes.image.data.attributes.url;
        } else if(attr.country?.data?.attributes?.image?.data?.attributes?.url) {
          let cImg = attr.country.data.attributes.image.data.attributes.url;
          img = cImg.startsWith("http") ? cImg : item._base + cImg;
        }

        let btns = "";
        (attr.embeds?.data || []).forEach(em => {
          let raw = em.attributes.embed_iframe || "";
          
          // LIMPIEZA DE LINK (V18)
          let clean = raw;
          if(raw.includes('<iframe')) {
            const m = raw.match(/src=["'](.*?)["']/);
            if(m) clean = m[1];
          }

          let payload = "";
          try {
            if(clean.includes("?r=")) payload = clean.split("?r=")[1];
            else if(clean.startsWith("http")) payload = btoa(clean);
            else payload = btoa(clean); 
          } catch(e){}

          if(payload) {
            // USAR ATRIBUTOS DATA (CRÍTICO)
            const safeTitle = attr.diary_description.replace(/"/g, "&quot;");
            btns += `<div class="btn-channel" data-link="${payload}" data-title="${safeTitle}"><i class="fas fa-play"></i> ${em.attributes.embed_name}</div>`;
          }
        });

        if(!btns) btns = '<div style="text-align:center; font-size:11px; opacity:0.5; padding:10px;">Opción no disponible</div>';

        const html = `
          <div class="card ${isLive ? 'live-on' : ''}" data-fav="${isFav}">
            <div class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${id}', this)"><i class="${isFav ? 'fas' : 'far'} fa-heart"></i></div>
            <div class="card-header" onclick="void(0)">
              <div class="time-badge">
                <span>${time.replace(/[a-z]/gi,'').trim()}</span>
                <small>${time.replace(/[0-9:]/g,'').trim() || 'HOY'}</small>
              </div>
              <div class="match-info">
                <img src="${img}" class="match-img" onerror="this.src='https://via.placeholder.com/40?text=L'">
                <div>
                  <div class="match-title">${attr.diary_description}</div>
                  <div class="league-name">${attr.league_name || "MUNDO"}</div>
                </div>
              </div>
              <i class="fas fa-chevron-down expand-icon"></i>
            </div>
            <div class="channels-box"><div class="channels-grid">${btns}</div></div>
          </div>
        `;
        container.append(html);
      });
    }

    function toggleFav(id, btn) {
      event.stopPropagation();
      const idx = favs.indexOf(id);
      if(idx === -1) {
        favs.push(id);
        $(btn).addClass('active').html('<i class="fas fa-heart"></i>');
        $(btn).closest('.card').attr('data-fav', 'true');
      } else {
        favs.splice(idx, 1);
        $(btn).removeClass('active').html('<i class="far fa-heart"></i>');
        $(btn).closest('.card').attr('data-fav', 'false');
      }
      localStorage.setItem('jj_ucl_favs', JSON.stringify(favs));
    }

    function filterEvents(type, btn) {
      $('.chip').removeClass('active');
      $(btn).addClass('active');
      $('.card').hide();
      if(type === 'all') $('.card').show();
      else if(type === 'live') $('.card.live-on').show();
      else if(type === 'fav') $('.card[data-fav="true"]').show();
    }

    // --- REPRODUCTOR V18 (FORZADO) ---
    let currLink = "";

    function playCh(b64, title) {
      try {
        currLink = atob(decodeURIComponent(b64));
        $('#player-title').text(title);
        $('#player-overlay').addClass('visible'); // USAR CLASE VISIBLE
        
        const v = document.getElementById('viewer');
        // SANDBOX ESTRICTO
        v.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-pointer-lock allow-presentation');
        v.src = currLink;

        // ANIMACIÓN ESCUDO
        $('#ad-shield').show().css('opacity', 1);
        $('#unlock-btn').show();
        $('#shield-txt').text("CONECTANDO...");
        $('#shield-prog').css('width', '0%');

        let p = 0;
        const interval = setInterval(() => {
          p++;
          $('#shield-prog').css('width', (p/7)*100 + '%');
          $('#shield-txt').text(`BLOQUEANDO PUBLICIDAD ${p}/7...`);
          if(p >= 7) {
            clearInterval(interval);
            $('#shield-txt').text("SEÑAL LIMPIA");
            setTimeout(() => {
              $('#ad-shield').animate({opacity: 0}, 500, function(){ $(this).hide(); });
            }, 500);
          }
        }, 800);

      } catch(e) { alert("Error de enlace"); }
    }

    function closePlayer() {
      const v = document.getElementById('viewer');
      v.src = "";
      v.removeAttribute('sandbox');
      $('#player-overlay').removeClass('visible');
    }

    function forceUnlock() {
      if(confirm("¿Pantalla en negro? Desbloquear permitirá la carga completa.\n\n¿Continuar?")) {
        const v = document.getElementById('viewer');
        v.removeAttribute('sandbox');
        v.src = currLink;
        $('#ad-shield, #unlock-btn').hide();
      }
    }

    let chatL = false;
    function toggleChat() {
      $('#chat-box').toggleClass('open');
      if($('#chat-box').hasClass('open') && !chatL) {
        $('#chat-frame').attr('src', "https://www3.cbox.ws/box/?boxid=3550648&boxtag=KQBTQs");
        chatL = true;
      }
    }
  </script>
</body>
</html>
