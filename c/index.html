<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <title>JJFUTBOL 2026</title>
  
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <style>
    /* --- ESTILOS 2026 (Dark & Gold) --- */
    :root {
      --bg-dark: #050507;
      --card-bg: rgba(30, 35, 50, 0.9);
      --card-border: rgba(255, 255, 255, 0.1);
      --accent: #D4AF37; /* Dorado */
      --live: #ff4444;   /* Rojo Vivo */
      --text-main: #ffffff;
      --text-muted: #9ca3af;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Outfit', sans-serif;
      background: radial-gradient(circle at 50% 0%, #1a1f35 0%, #000000 80%);
      margin: 0; padding: 0; color: var(--text-main);
      min-height: 100vh; overflow-x: hidden;
    }

    .view-section { width: 100%; min-height: 100vh; transition: opacity 0.3s; }
    .hidden { display: none !important; opacity: 0; }

    /* HEADER */
    header {
      padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;
      background: rgba(5, 5, 7, 0.95); backdrop-filter: blur(10px);
      position: sticky; top: 0; z-index: 50; border-bottom: 1px solid var(--card-border);
    }
    .app-brand { font-size: 22px; font-weight: 800; background: linear-gradient(to right, #fff, var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .btn-reload { width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1); color: white; border: none; font-size: 18px; display: flex; align-items: center; justify-content: center; }

    /* AGENDA */
    .container { max-width: 800px; margin: 0 auto; padding: 15px 15px 80px; }

    .search-box { position: relative; margin-bottom: 15px; }
    .search-box input { width: 100%; padding: 12px 15px 12px 45px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 25px; color: white; outline: none; font-family: 'Outfit'; }
    .search-box i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

    .filters { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 20px; scrollbar-width: none; justify-content: center; }
    .chip { padding: 8px 18px; background: rgba(255,255,255,0.08); border-radius: 20px; font-size: 13px; font-weight: 600; color: var(--text-muted); white-space: nowrap; border: 1px solid transparent; cursor: pointer; transition: 0.2s; }
    .chip.active { background: var(--accent); color: black; font-weight: 700; box-shadow: 0 0 10px rgba(212, 175, 55, 0.3); }
    .chip.live.active { background: var(--live); color: white; box-shadow: 0 0 10px rgba(255, 68, 68, 0.3); }
    .chip.fav.active { background: #ec4899; color: white; box-shadow: 0 0 10px rgba(236, 72, 153, 0.3); }

    .promo { background: linear-gradient(135deg, #2a0f0f, #000); padding: 15px; border-radius: 16px; border: 1px solid rgba(255,68,68,0.3); display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .btn-cine { background: white; color: #cc0000; font-weight: 800; padding: 6px 14px; border-radius: 20px; font-size: 11px; text-decoration: none; }

    #menu { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 12px; }

    .match-card {
      background: var(--card-bg); border: 1px solid var(--card-border);
      border-radius: 16px; overflow: hidden; position: relative; transition: transform 0.2s;
    }
    .match-card:active { transform: scale(0.98); background: rgba(40, 45, 60, 0.9); }
    
    .fav-icon { position: absolute; top: 0; right: 0; padding: 12px; font-size: 18px; color: rgba(255,255,255,0.2); z-index: 10; }
    .fav-icon.active { color: #ec4899; animation: pop 0.3s; }
    @keyframes pop { 50% { transform: scale(1.4); } }

    .card-header { padding: 15px; display: flex; align-items: center; gap: 15px; }
    
    .time-box { 
      background: rgba(255,255,255,0.05); padding: 8px 0; width: 55px; border-radius: 10px; text-align: center; border: 1px solid var(--card-border);
      display: flex; flex-direction: column; justify-content: center;
    }
    .time-box span { font-weight: 700; font-size: 13px; color: white; }
    .time-box small { font-size: 8px; color: var(--text-muted); margin-top: 2px; }
    .match-card[data-live="true"] .time-box { border-color: var(--live); }
    .match-card[data-live="true"] .time-box span { color: var(--live); }
    
    .match-info { flex: 1; overflow: hidden; }
    .match-title { font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 4px; line-height: 1.2; }
    .league-name { font-size: 10px; color: var(--accent); text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; }
    .league-img { width: 35px; height: 35px; object-fit: contain; margin-right: 10px; }

    .channels-container { display: none; padding: 0 15px 15px; background: rgba(0,0,0,0.3); border-top: 1px solid var(--card-border); }
    .channels-list { list-style: none; padding: 10px 0 0; margin: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

    /* BOTONES (CLASE ESPECIAL PARA JS) */
    .btn-channel {
      background: rgba(255,255,255,0.05); border: 1px solid var(--card-border); color: white;
      padding: 12px; border-radius: 10px; font-size: 12px; font-weight: 600; text-align: center; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .btn-channel:active { background: var(--accent); color: black; }

    /* PLAYER */
    #view-player { background: black; position: fixed; inset: 0; z-index: 100; display: flex; flex-direction: column; }
    .player-top { padding: 15px; background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent); position: absolute; width: 100%; z-index: 50; display: flex; align-items: center; gap: 15px; }
    .btn-back { width: 35px; height: 35px; border-radius: 50%; background: rgba(255,255,255,0.2); color: white; border: none; display: flex; align-items: center; justify-content: center; font-size: 16px; backdrop-filter: blur(5px); }

    .video-area { flex: 1; display: flex; align-items: center; position: relative; }
    .video-frame { width: 100%; aspect-ratio: 16/9; position: relative; background: black; }
    iframe#viewer { width: 100%; height: 100%; border: none; }

    /* SHIELD & AUTO-CLICK 7 */
    #titan-shield { position: absolute; inset: 0; background: transparent; z-index: 20; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
    .status-msg { background: rgba(0,0,0,0.85); color: #00ff88; padding: 10px 20px; border-radius: 30px; font-size: 12px; font-weight: 700; border: 1px solid #00ff88; display: flex; align-items: center; gap: 8px; box-shadow: 0 0 15px rgba(0,255,136,0.3); }
    
    #unlock-btn { position: absolute; top: 60px; right: 10px; z-index: 60; background: rgba(0,0,0,0.6); color: #ffaaaa; border: 1px solid #ff4444; padding: 6px 12px; border-radius: 20px; font-size: 10px; font-weight: 700; display: none; cursor: pointer; }

    .info-area { padding: 20px; background: #050507; flex: 1; border-top: 1px solid var(--card-border); }
    
    /* Chat */
    .chat-box { margin-top: 15px; border: 1px solid var(--card-border); border-radius: 12px; overflow: hidden; background: #101015; }
    .chat-header { padding: 10px 15px; background: rgba(255,255,255,0.05); font-size: 13px; font-weight: 700; display: flex; justify-content: space-between; cursor: pointer; }
    .chat-body { height: 0; transition: height 0.3s; }
    .chat-body.open { height: 350px; }

  </style>
</head>
<body>

  <div id="view-agenda" class="view-section">
    <header>
      <div class="app-brand">JJFUTBOL <span style="color:var(--accent); font-size:12px;">2026</span></div>
      <button class="btn-reload" onclick="location.reload()"><i class="fas fa-rotate-right"></i></button>
    </header>

    <div class="container">
      
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" id="search" placeholder="Buscar partido...">
      </div>

      <div class="filters">
        <div class="chip active" onclick="filter('all', this)">Todos</div>
        <div class="chip live" onclick="filter('live', this)">üî¥ En Vivo</div>
        <div class="chip fav" onclick="filter('fav', this)">‚ù§Ô∏è Favoritos</div>
      </div>

      <div class="promo">
        <div>
          <div style="color:white; font-weight:700;">JJMOVIES 2026</div>
          <div style="color:#aaa; font-size:11px;">Pel√≠culas Gratis</div>
        </div>
        <a href="https://jjmovies.lat" target="_blank" class="btn-cine">VER AHORA</a>
      </div>

      <ul id="menu"></ul>
      <div id="loading" style="text-align:center; padding:40px; color:#666;">Cargando partidos...</div>
    </div>
  </div>

  <div id="view-player" class="hidden">
    <div class="player-top">
      <button class="btn-back" onclick="closePlayer()"><i class="fas fa-arrow-left"></i></button>
      <span style="font-weight:700; font-size:14px; color:white;">En Vivo</span>
    </div>

    <div class="video-area">
      <div class="video-frame">
        <div id="unlock-btn" onclick="unlock()">DESBLOQUEAR / OPCI√ìN 2</div>
        <div id="titan-shield">
          <div class="status-msg"><i class="fas fa-bolt"></i> <span id="shield-text">INICIANDO...</span></div>
        </div>
        <iframe id="viewer" src="" allowfullscreen allow="autoplay; encrypted-media"></iframe>
      </div>
    </div>

    <div class="info-area">
      <h3 id="player-title" style="margin:0 0 15px; font-size:16px; color:white;">Evento</h3>
      
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
        <a href="https://t.me/+EPyKMpHXlv5lMmYx" target="_blank" style="background:#229ED9; color:white; padding:10px; border-radius:10px; text-align:center; text-decoration:none; font-size:12px; font-weight:700;">TELEGRAM</a>
        <a href="https://jjmovies.lat" target="_blank" style="background:var(--accent); color:black; padding:10px; border-radius:10px; text-align:center; text-decoration:none; font-size:12px; font-weight:700;">PEL√çCULAS</a>
      </div>

      <div class="chat-box">
        <div class="chat-header" onclick="toggleChat()">
          <span>CHAT COMUNIDAD</span> <i class="fas fa-chevron-down"></i>
        </div>
        <div class="chat-body" id="chat-content">
          <iframe id="chat-frame" width="100%" height="100%" frameborder="0"></iframe>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- 1. CARGA DE DATOS ---
    const API_URLS = [
      { url: "https://a.ftvhd.com/diaries.json", base: "https://img.futbolonlinehd.com" },
      { url: "https://golazoplay.com/agenda.json?v=1.0", base: "https://img.golazoplay.com" }
    ];
    let favorites = JSON.parse(localStorage.getItem('jj_favs') || '[]');

    $(document).ready(() => {
      loadData();
      
      $('#search').on('keyup', function() {
        const val = $(this).val().toLowerCase();
        $('.match-card').toggle(function() {
          return $(this).text().toLowerCase().indexOf(val) > -1;
        });
      });

      // Expandir tarjeta
      $(document).on('click', '.match-card', function(e) {
        if($(e.target).closest('.fav-icon, .btn-channel').length) return;
        $('.match-card').not(this).removeClass('active').find('.channels-container').slideUp(200);
        $(this).toggleClass('active').find('.channels-container').slideToggle(200);
      });

      // --- CLIC EN CANAL (SOLUCI√ìN T√âCNICA) ---
      // Usamos "delegaci√≥n" y leemos atributos "data" para que no se rompa nunca
      $(document).on('click', '.btn-channel', function(e) {
        e.stopPropagation();
        const b64 = $(this).data('url');
        const title = $(this).data('title');
        play(b64, title);
      });
    });

    async function loadData() {
      try {
        const promises = API_URLS.map(api => fetch(api.url + "?t=" + Date.now()).then(r=>r.json()).then(d => d.data.map(i => ({...i, _base: api.base}))));
        const res = await Promise.all(promises);
        const events = res.flat();
        
        const unique = [];
        const seen = new Set();
        events.forEach(ev => {
          const k = ev.attributes.diary_description + ev.attributes.diary_hour;
          if(!seen.has(k)) { seen.add(k); unique.push(ev); }
        });
        unique.sort((a,b) => (a.attributes.diary_hour || "00:00").localeCompare(b.attributes.diary_hour || "00:00"));

        render(unique);
        $('#loading').hide();
      } catch(e) {
        $('#loading').text("Error de conexi√≥n. Recarga.");
      }
    }

    function render(list) {
      const menu = $('#menu');
      menu.empty();

      if(list.length === 0) {
        menu.html('<div style="text-align:center; padding:30px;">No hay eventos hoy.</div>');
        return;
      }

      list.forEach(item => {
        const attr = item.attributes;
        const id = btoa(unescape(encodeURIComponent(attr.diary_description + attr.diary_hour))).replace(/=/g, '');
        const isFav = favorites.includes(id);

        let time = "--:--";
        let isLive = false;
        if(attr.diary_hour) {
          const dt = luxon.DateTime.fromFormat(attr.diary_hour.substring(0,5), "HH:mm", {zone:"America/Lima"});
          const now = luxon.DateTime.now().setZone("America/Lima");
          time = dt.toLocal().toFormat("HH:mm");
          const diff = now.diff(dt, 'minutes').minutes;
          if(diff >= 0 && diff < 130) isLive = true;
        }

        // Logo Liga
        let img = "https://via.placeholder.com/35?text=VS";
        if(attr.league?.data?.attributes?.image?.data?.attributes?.url) {
          img = item._base + attr.league.data.attributes.image.data.attributes.url;
        } else if (attr.country?.data?.attributes?.image?.data?.attributes?.url) {
          img = item._base + attr.country.data.attributes.image.data.attributes.url;
        }

        // --- GENERADOR DE BOTONES SEGURO ---
        let btns = "";
        (attr.embeds?.data || []).forEach(em => {
          let url = em.attributes.embed_iframe || "";
          
          // Link Fixer
          if(url.includes('<iframe')) {
            const m = url.match(/src=["'](.*?)["']/);
            if(m) url = m[1];
          }

          let payload = "";
          try {
            if(url.includes("?r=")) payload = url.split("?r=")[1];
            else payload = btoa(url);
          } catch(e){}

          if(payload) {
            // AQU√ç EST√Å EL TRUCO: data-url y data-title en vez de onclick()
            // Esto evita que las comillas rompan el c√≥digo
            btns += `<div class="btn-channel" data-url="${payload}" data-title="${attr.diary_description.replace(/"/g, '"')}"><i class="fas fa-play"></i> ${em.attributes.embed_name}</div>`;
          }
        });

        if(!btns) btns = '<div style="grid-column:1/-1; text-align:center; font-size:11px; opacity:0.5;">Sin se√±al</div>';

        const html = `
          <li class="match-card" data-live="${isLive}" data-fav="${isFav}">
            <div class="fav-icon ${isFav ? 'active' : ''}" onclick="toggleFav('${id}', this)"><i class="${isFav ? 'fas' : 'far'} fa-heart"></i></div>
            <div class="card-header">
              <div class="time-box">
                <span style="${isLive ? 'color:var(--live)' : ''}">${time}</span>
                <small>${isLive ? 'VIVO' : 'HORA'}</small>
              </div>
              <div style="display:flex; align-items:center;">
                <img src="${img}" class="league-img">
                <div class="match-info">
                  <div class="match-title">${attr.diary_description}</div>
                  <div class="league-name">${attr.league_name || "Mundo"}</div>
                </div>
              </div>
            </div>
            <div class="channels-container">
              <div class="channels-list">${btns}</div>
            </div>
          </li>
        `;
        menu.append(html);
      });
    }

    function toggleFav(id, btn) {
      const idx = favorites.indexOf(id);
      if(idx === -1) {
        favorites.push(id);
        $(btn).addClass('active').html('<i class="fas fa-heart"></i>');
        $(btn).closest('li').attr('data-fav', 'true');
      } else {
        favorites.splice(idx, 1);
        $(btn).removeClass('active').html('<i class="far fa-heart"></i>');
        $(btn).closest('li').attr('data-fav', 'false');
      }
      localStorage.setItem('jj_favs', JSON.stringify(favorites));
    }

    function filter(type, btn) {
      $('.chip').removeClass('active');
      $(btn).addClass('active');
      $('.match-card').hide();
      
      if(type === 'all') $('.match-card').show();
      else if(type === 'live') $('.match-card[data-live="true"]').show();
      else if(type === 'fav') $('.match-card[data-fav="true"]').show();
    }

    // --- 2. REPRODUCTOR (AUTO-CLICK x7) ---
    let currentSrc = "";
    
    function play(b64, title) {
      try {
        currentSrc = atob(decodeURIComponent(b64));
        $('#player-title').text(title);
        $('#view-agenda').addClass('hidden');
        $('#view-player').removeClass('hidden');
        
        // Cargar
        const v = document.getElementById('viewer');
        v.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-pointer-lock allow-presentation');
        v.src = currentSrc;

        // Auto-Click x7
        $('#titan-shield').show().css('opacity', 1);
        $('#unlock-btn').show();
        let c = 1;
        $('#shield-text').text("INICIANDO...");
        
        const timer = setInterval(() => {
          if(c <= 7) {
            $('#shield-text').text(`BLOQUEANDO ANUNCIO ${c}/7...`);
            c++;
          } else {
            clearInterval(timer);
            $('#shield-text').text("‚úÖ LISTO");
            setTimeout(() => {
              $('#titan-shield').animate({opacity: 0}, 500, function(){ $(this).hide(); });
            }, 500);
          }
        }, 700);

      } catch(e) { alert("Error de enlace"); }
    }

    function closePlayer() {
      const v = document.getElementById('viewer');
      v.src = "";
      v.removeAttribute('sandbox');
      $('#view-player').addClass('hidden');
      $('#view-agenda').removeClass('hidden');
    }

    function unlock() {
      if(confirm("¬øPantalla negra? Desbloquear permitir√° anuncios del servidor.\n\n¬øSeguro?")) {
        const v = document.getElementById('viewer');
        v.removeAttribute('sandbox');
        v.src = currentSrc;
        $('#titan-shield, #unlock-btn').hide();
      }
    }

    let chatReady = false;
    function toggleChat() {
      const body = $('#chat-content');
      body.toggleClass('open');
      if(body.hasClass('open') && !chatReady) {
        $('#chat-frame').attr('src', "https://www3.cbox.ws/box/?boxid=3550648&boxtag=KQBTQs");
        chatReady = true;
      }
    }
  </script>
</body>
</html>
