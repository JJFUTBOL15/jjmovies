<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JJMovies - Ver Películas y Series Online Gratis</title>
    <meta name="description" content="Mira los últimos estrenos de películas y series en HD gratis en JJMovies.">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-main: #0a101d; /* Color de fondo Cuevana */
            --bg-card: #151e2e;
            --accent: #3b82f6; /* Azul brillante */
            --text-gray: #9ca3af;
        }

        body {
            background-color: var(--bg-main);
            color: white;
            font-family: 'Inter', sans-serif;
        }

        /* Scrollbar estilo Cuevana */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-main); }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* Efectos de Imagen */
        .poster-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .poster-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
            z-index: 10;
        }
        
        .play-overlay {
            background: rgba(0, 0, 0, 0.6);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .poster-card:hover .play-overlay {
            opacity: 1;
        }

        /* Gradiente del Hero */
        .hero-gradient {
            background: linear-gradient(to top, var(--bg-main) 10%, transparent 100%);
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Modal Player */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: all 0.3s ease; }
        .modal-exit { opacity: 1; transform: scale(1); }
        .modal-exit-active { opacity: 0; transform: scale(0.95); transition: all 0.2s ease; }
    </style>
</head>
<body>

    <header class="fixed top-0 w-full z-50 bg-[#0a101d]/90 backdrop-blur-md border-b border-white/5 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between gap-4">
            <a href="#" class="flex items-center gap-2 flex-shrink-0" onclick="location.reload()">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/30">
                    <i data-lucide="play" class="fill-white w-4 h-4"></i>
                </div>
                <span class="text-xl font-black tracking-tighter text-white">JJ<span class="text-blue-500">MOVIES</span></span>
            </a>

            <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-gray-300">
                <a href="#" class="hover:text-white transition-colors text-white">Inicio</a>
                <a href="#movies" class="hover:text-blue-400 transition-colors">Películas</a>
                <a href="#series" class="hover:text-blue-400 transition-colors">Series</a>
                <a href="#" class="hover:text-blue-400 transition-colors">Géneros</a>
            </nav>

            <div class="flex-1 max-w-md hidden sm:block relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i data-lucide="search" class="w-4 h-4 text-gray-500"></i>
                </div>
                <input type="text" id="search-input" placeholder="Buscar película o serie..." 
                       class="w-full bg-[#151e2e] border border-gray-700 text-white text-sm rounded-full focus:ring-blue-500 focus:border-blue-500 block pl-10 p-2.5 placeholder-gray-500 transition-all focus:bg-[#1a2639]"
                       onkeypress="handleSearch(event)">
            </div>

            <button class="md:hidden text-white" onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-[#151e2e] border-t border-gray-800 p-4">
            <input type="text" id="search-input-mobile" placeholder="Buscar..." class="w-full bg-black/30 border border-gray-700 rounded p-2 text-white mb-4" onkeypress="handleSearch(event)">
            <a href="#movies" class="block py-2 text-gray-300 hover:text-white">Películas</a>
            <a href="#series" class="block py-2 text-gray-300 hover:text-white">Series</a>
        </div>
    </header>

    <section class="relative h-[70vh] w-full overflow-hidden mt-16 group">
        <div id="hero-backdrop" class="absolute inset-0 bg-cover bg-center transition-all duration-700 ease-in-out" style="background-image: url('');">
            <div class="absolute inset-0 bg-black/40"></div>
            <div class="absolute inset-0 hero-gradient"></div>
        </div>

        <div class="relative container mx-auto px-4 h-full flex flex-col justify-end pb-16 z-10">
            <span class="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded w-fit mb-3">DESTACADO HOY</span>
            <h1 id="hero-title" class="text-4xl md:text-6xl font-black text-white mb-4 drop-shadow-lg leading-tight max-w-3xl">Cargando...</h1>
            <p id="hero-desc" class="text-gray-300 text-sm md:text-lg max-w-2xl line-clamp-2 mb-6 drop-shadow-md">...</p>
            
            <div class="flex gap-4">
                <button id="hero-play-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-full font-bold flex items-center gap-2 transition-transform hover:scale-105 shadow-lg shadow-blue-600/30">
                    <i data-lucide="play-circle" class="w-5 h-5"></i> Ver Ahora
                </button>
                <button class="bg-white/10 hover:bg-white/20 backdrop-blur-sm border border-white/20 text-white px-6 py-3 rounded-full font-medium flex items-center gap-2 transition-colors">
                    <i data-lucide="info" class="w-5 h-5"></i> Detalles
                </button>
            </div>
        </div>
    </section>

    <main class="container mx-auto px-4 py-10 space-y-12">

        <div id="search-results-container" class="hidden">
            <div class="flex items-center justify-between mb-6 border-l-4 border-blue-500 pl-4">
                <h2 class="text-2xl font-bold text-white">Resultados de búsqueda</h2>
                <button onclick="closeSearch()" class="text-gray-400 hover:text-white"><i data-lucide="x"></i> Cerrar</button>
            </div>
            <div id="search-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6"></div>
        </div>

        <section id="movies">
            <div class="flex items-center justify-between mb-6 border-l-4 border-blue-500 pl-4">
                <h2 class="text-2xl font-bold text-white">Películas Estreno</h2>
                <a href="#" class="text-xs text-blue-400 hover:text-white uppercase font-bold tracking-wider">Ver todas</a>
            </div>
            <div id="movies-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6">
                <div class="col-span-full text-center py-10"><div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto"></div></div>
            </div>
        </section>

        <section id="series">
            <div class="flex items-center justify-between mb-6 border-l-4 border-purple-500 pl-4">
                <h2 class="text-2xl font-bold text-white">Series Tendencia</h2>
                <a href="#" class="text-xs text-purple-400 hover:text-white uppercase font-bold tracking-wider">Ver todas</a>
            </div>
            <div id="series-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6">
                </div>
        </section>

    </main>

    <footer class="bg-[#050911] border-t border-white/5 py-10 mt-10">
        <div class="container mx-auto px-4 text-center">
            <div class="flex items-center justify-center gap-2 mb-4">
                <i data-lucide="play" class="fill-blue-600 text-blue-600 w-6 h-6"></i>
                <span class="text-2xl font-black text-white">JJ<span class="text-blue-600">MOVIES</span></span>
            </div>
            <p class="text-gray-500 text-sm mb-6 max-w-xl mx-auto">JJMovies es el mejor sitio para ver películas y series online gratis. Sin anuncios molestos y en alta calidad HD.</p>
            <div class="flex justify-center gap-6 text-sm text-gray-400">
                <a href="#" class="hover:text-white">Términos</a>
                <a href="#" class="hover:text-white">Privacidad</a>
                <a href="#" class="hover:text-white">DMCA</a>
            </div>
            <p class="text-gray-600 text-xs mt-8">© 2024 JJMovies. Todos los derechos reservados.</p>
        </div>
    </footer>

    <div id="player-modal" class="fixed inset-0 z-[100] hidden bg-black/95 backdrop-blur flex items-center justify-center p-4">
        <div class="relative w-full max-w-5xl bg-[#0f172a] rounded-xl overflow-hidden shadow-2xl border border-gray-700 flex flex-col">
            <div class="flex justify-between items-center p-4 bg-[#1e293b] border-b border-gray-700">
                <h3 id="player-title" class="text-white font-bold truncate pr-4">Reproduciendo...</h3>
                <button onclick="closePlayer()" class="text-gray-400 hover:text-red-500 transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div id="series-controls" class="hidden p-3 bg-[#0f172a] border-b border-gray-800 flex gap-4 justify-center">
                <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400 uppercase font-bold">Temporada:</span>
                    <input type="number" id="season-input" value="1" min="1" class="bg-gray-800 text-white w-12 text-center rounded border border-gray-600 focus:border-blue-500 outline-none text-sm p-1" onchange="refreshPlayer()">
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400 uppercase font-bold">Episodio:</span>
                    <input type="number" id="episode-input" value="1" min="1" class="bg-gray-800 text-white w-12 text-center rounded border border-gray-600 focus:border-blue-500 outline-none text-sm p-1" onchange="refreshPlayer()">
                </div>
                <button onclick="refreshPlayer()" class="bg-blue-600 hover:bg-blue-700 text-white text-xs px-3 rounded uppercase font-bold"><i data-lucide="refresh-cw" class="w-3 h-3 inline"></i> Cargar</button>
            </div>

            <div class="relative aspect-video w-full bg-black">
                <div id="loader-video" class="absolute inset-0 flex items-center justify-center text-blue-500">
                    <i data-lucide="loader-2" class="w-10 h-10 animate-spin"></i>
                </div>
                <iframe id="video-frame" class="absolute inset-0 w-full h-full" frameborder="0" allowfullscreen allow="autoplay"></iframe>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const API_KEY = 'da8b836389708e0558de674492931977'; // API Key Pública TMDB
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE = 'https://image.tmdb.org/t/p/w300';
        const BACKDROP_BASE = 'https://image.tmdb.org/t/p/original';
        
        // ¡¡¡ TU REPRODUCTOR AQUÍ !!!
        const PLAYER_URL = 'https://jjmovies.lat/player.html';

        let currentMedia = { id: null, type: 'movie' };

        // --- INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadHero();
            loadCategory('movie', 'popular', 'movies-grid');
            loadCategory('tv', 'trending/tv/week', 'series-grid', true); // True = usa endpoint directo
            
            // Header scroll effect
            window.addEventListener('scroll', () => {
                const nav = document.getElementById('navbar');
                if(window.scrollY > 50) nav.classList.add('bg-[#0a101d]', 'shadow-lg');
                else nav.classList.remove('bg-[#0a101d]', 'shadow-lg');
            });
        });

        // --- CARGAR DATOS ---
        async function loadHero() {
            try {
                // Obtenemos películas en tendencia hoy
                const res = await fetch(`${BASE_URL}/trending/movie/day?api_key=${API_KEY}&language=es-MX`);
                const data = await res.json();
                const heroMovie = data.results[0]; // La #1

                // Pintar Hero
                document.getElementById('hero-backdrop').style.backgroundImage = `url('${BACKDROP_BASE}${heroMovie.backdrop_path}')`;
                document.getElementById('hero-title').innerText = heroMovie.title;
                document.getElementById('hero-desc').innerText = heroMovie.overview;
                
                // Configurar botón "Ver Ahora" del Hero
                const btn = document.getElementById('hero-play-btn');
                btn.onclick = () => openPlayer('movie', heroMovie.id, heroMovie.title);

            } catch (e) { console.error("Error loading hero", e); }
        }

        async function loadCategory(type, category, containerId, isDirectUrl = false) {
            const container = document.getElementById(containerId);
            try {
                let url = isDirectUrl 
                    ? `${BASE_URL}/${category}?api_key=${API_KEY}&language=es-MX` 
                    : `${BASE_URL}/${type}/${category}?api_key=${API_KEY}&language=es-MX`;

                const res = await fetch(url);
                const data = await res.json();
                
                container.innerHTML = data.results.slice(0, 12).map(item => createCard(item, type)).join('');
                lucide.createIcons();
            } catch (e) {
                container.innerHTML = '<p class="text-red-500">Error cargando contenido.</p>';
            }
        }

        // --- BUSCADOR ---
        async function handleSearch(e) {
            if (e.key === 'Enter') {
                const query = e.target.value;
                if (!query) return;

                const container = document.getElementById('search-grid');
                const resultsArea = document.getElementById('search-results-container');
                
                resultsArea.classList.remove('hidden');
                container.innerHTML = '<div class="col-span-full text-center py-4 text-gray-400">Buscando...</div>';
                
                // Scroll suave hacia resultados
                resultsArea.scrollIntoView({ behavior: 'smooth' });

                try {
                    // Buscar pelis y series
                    const [resMov, resTv] = await Promise.all([
                        fetch(`${BASE_URL}/search/movie?api_key=${API_KEY}&language=es-MX&query=${encodeURIComponent(query)}`),
                        fetch(`${BASE_URL}/search/tv?api_key=${API_KEY}&language=es-MX&query=${encodeURIComponent(query)}`)
                    ]);
                    
                    const dataMov = await resMov.json();
                    const dataTv = await resTv.json();
                    
                    // Combinar resultados
                    let combined = [
                        ...dataMov.results.map(i => ({...i, media_type: 'movie'})),
                        ...dataTv.results.map(i => ({...i, media_type: 'tv'}))
                    ];

                    // Filtrar sin poster
                    combined = combined.filter(i => i.poster_path);

                    if(combined.length === 0) {
                        container.innerHTML = '<div class="col-span-full text-center py-4 text-gray-400">No se encontraron resultados.</div>';
                    } else {
                        container.innerHTML = combined.map(item => createCard(item, item.media_type)).join('');
                        lucide.createIcons();
                    }

                } catch(e) { console.error(e); }
            }
        }

        function closeSearch() {
            document.getElementById('search-results-container').classList.add('hidden');
            document.getElementById('search-input').value = '';
        }

        // --- TEMPLATE DE CARTA (POSTER) ---
        function createCard(item, type) {
            const title = item.title || item.name;
            const date = item.release_date || item.first_air_date || 'N/A';
            const year = date.split('-')[0];
            const poster = item.poster_path ? `${IMAGE_BASE}${item.poster_path}` : 'https://via.placeholder.com/300x450?text=No+Img';
            const rating = item.vote_average ? item.vote_average.toFixed(1) : 'NR';
            
            // Escapar comillas para onclick
            const safeTitle = title.replace(/'/g, "\\'");

            return `
                <div class="poster-card relative bg-[#151e2e] rounded-lg overflow-hidden cursor-pointer group"
                     onclick="openPlayer('${type}', '${item.id}', '${safeTitle}')">
                    
                    <div class="aspect-[2/3] relative">
                        <img src="${poster}" class="w-full h-full object-cover" loading="lazy" alt="${title}">
                        
                        <div class="absolute top-2 right-2 bg-black/60 backdrop-blur text-white text-[10px] font-bold px-1.5 py-0.5 rounded border border-white/10">
                            ${year}
                        </div>
                        
                        <div class="absolute top-2 left-2 ${type === 'movie' ? 'bg-blue-600' : 'bg-purple-600'} text-white text-[9px] font-bold px-1.5 py-0.5 rounded shadow-lg uppercase">
                            ${type === 'movie' ? 'Peli' : 'Serie'}
                        </div>

                        <div class="play-overlay absolute inset-0 flex items-center justify-center">
                            <div class="bg-white/20 backdrop-blur-sm p-3 rounded-full border border-white/30 transform scale-0 group-hover:scale-100 transition-transform duration-300">
                                <i data-lucide="play" class="fill-white w-8 h-8 text-white ml-1"></i>
                            </div>
                        </div>
                    </div>

                    <div class="p-3">
                        <h3 class="text-white font-bold text-sm truncate hover:text-blue-400 transition-colors">${title}</h3>
                        <div class="flex items-center justify-between mt-1 text-xs text-gray-400">
                            <span class="flex items-center gap-1"><i data-lucide="star" class="w-3 h-3 text-yellow-500 fill-current"></i> ${rating}</span>
                            <span>HD</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // --- PLAYER LOGIC ---
        function openPlayer(type, id, title) {
            currentMedia = { type, id };
            const modal = document.getElementById('player-modal');
            const iframe = document.getElementById('video-frame');
            const seriesControls = document.getElementById('series-controls');
            const titleEl = document.getElementById('player-title');

            titleEl.innerText = title;
            modal.classList.remove('hidden');
            
            // Configurar UI Serie vs Peli
            if (type === 'tv') {
                seriesControls.classList.remove('hidden');
                // Reset a S1 E1
                document.getElementById('season-input').value = 1;
                document.getElementById('episode-input').value = 1;
                // Cargar S1E1
                iframe.src = `${PLAYER_URL}?id=${id}&season=1&episode=1`;
            } else {
                seriesControls.classList.add('hidden');
                // Cargar Peli
                iframe.src = `${PLAYER_URL}?id=${id}`;
            }
        }

        function refreshPlayer() {
            const iframe = document.getElementById('video-frame');
            const s = document.getElementById('season-input').value;
            const e = document.getElementById('episode-input').value;
            
            // Resetear src para mostrar loading un segundo (opcional)
            iframe.src = 'about:blank';
            
            setTimeout(() => {
                iframe.src = `${PLAYER_URL}?id=${currentMedia.id}&season=${s}&episode=${e}`;
            }, 100);
        }

        function closePlayer() {
            const modal = document.getElementById('player-modal');
            const iframe = document.getElementById('video-frame');
            
            modal.classList.add('hidden');
            iframe.src = ''; // Detener video
        }

    </script>
</body>
</html>
