<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#141414">
    <title>JJMOVIES - MASTER EDITION</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@100;300;400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* Variables Globales */
        :root {
            --primary-red: #E50914;
            --primary-black: #141414;
            --dark-gray: #181818;
            --light-gray: #b3b3b3;
            --shadow-elevation: 0 4px 6px -1px rgba(0, 0, 0, 0.5), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
        }

        /* Reset y Base */
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-black);
            color: white;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* Tipografía Especial */
        .brand-logo {
            font-family: 'Bebas Neue', cursive;
            color: var(--primary-red);
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            user-select: none;
        }

        /* Scrollbars Personalizados */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
            background: #000;
        }
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Utilidad para ocultar scroll pero permitir deslizamiento */
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* ================= ANIMACIONES ================= */
        
        /* Fade In Suave */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        /* Slide Up para el Hero */
        @keyframes slideUp {
            from { transform: translateY(40px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
            animation: slideUp 0.8s ease-out 0.2s forwards;
            opacity: 0; /* Empieza invisible */
        }

        /* Efecto Hover en Tarjetas */
        .movie-card {
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), z-index 0s;
            position: relative;
            z-index: 1;
        }
        .movie-card:hover {
            transform: scale(1.15);
            z-index: 100;
            box-shadow: 0 10px 20px rgba(0,0,0,0.7);
            border-radius: 4px;
        }
        /* Mobile: reducir efecto hover para no molestar */
        @media (max-width: 768px) {
            .movie-card:hover { transform: scale(1.05); }
        }

        /* ================= COMPONENTES UI ================= */

        /* Navbar Gradiente */
        .navbar-gradient {
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            transition: background-color 0.4s ease;
        }
        .navbar-solid {
            background-color: var(--primary-black);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* Hero Overlay (Vignette) */
        .hero-vignette {
            background: radial-gradient(circle, transparent 20%, #141414 130%);
            position: absolute; inset: 0;
        }
        .hero-bottom-fade {
            background: linear-gradient(to top, #141414 5%, transparent 60%);
            position: absolute; inset: 0;
        }

        /* Input de Búsqueda Animado */
        .search-box {
            background: rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }
        .search-box:focus-within {
            background: black;
            border-color: white;
            width: 280px;
        }

        /* Botones Principales */
        .btn-play {
            background-color: white;
            color: black;
            border-radius: 4px;
            font-weight: bold;
            transition: all 0.2s;
        }
        .btn-play:hover {
            background-color: #e6e6e6;
            transform: scale(1.02);
        }

        .btn-info {
            background-color: rgba(109, 109, 110, 0.7);
            color: white;
            border-radius: 4px;
            font-weight: bold;
            backdrop-filter: blur(5px);
            transition: all 0.2s;
        }
        .btn-info:hover {
            background-color: rgba(109, 109, 110, 0.4);
        }

        /* Modal / Popup */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
        }
        
        /* Iframe Player Container */
        .player-fullscreen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #000;
            z-index: 9999;
            display: none;
        }
        
        .close-player-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10000;
            background: rgba(0,0,0,0.5);
            border: 1px solid white;
            color: white;
            border-radius: 50px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.3s;
        }
        .close-player-btn:hover { background: var(--primary-red); border-color: var(--primary-red); }

        /* Loader Spinner */
        .netflix-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary-red);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* Footer Links */
        .footer-link { color: #808080; font-size: 13px; text-decoration: none; margin-bottom: 10px; display: block; }
        .footer-link:hover { text-decoration: underline; }

        /* Media Queries Específicos */
        @media (min-width: 1024px) {
            .hero-title { font-size: 5rem; }
            .row-container { padding-left: 3rem; padding-right: 3rem; }
        }
        @media (max-width: 768px) {
            .hero-title { font-size: 2.5rem; }
            .search-box { width: 100% !important; }
        }
    </style>
</head>

<body>

    <nav id="main-navbar" class="fixed w-full z-50 px-4 md:px-12 py-4 navbar-gradient flex items-center justify-between transition-all duration-300">
        
        <div class="flex items-center gap-8">
            <a href="#" onclick="window.location.reload()" class="text-3xl md:text-4xl brand-logo cursor-pointer hover:scale-105 transition-transform">JJMOVIES</a>
            
            <ul class="hidden md:flex gap-6 text-sm font-medium text-gray-300">
                <li><a href="#" onclick="app.renderHome()" class="hover:text-white hover:font-bold transition">Inicio</a></li>
                <li><a href="#" onclick="app.loadGenre(28, 'Acción')" class="hover:text-white transition">Acción</a></li>
                <li><a href="#" onclick="app.loadGenre(35, 'Comedia')" class="hover:text-white transition">Comedia</a></li>
                <li><a href="#" onclick="app.loadFavorites()" class="hover:text-white transition">Mi Lista</a></li>
                
                <li class="relative group">
                    <span class="cursor-pointer hover:text-white flex items-center gap-1">Más <i class="fas fa-caret-down"></i></span>
                    <div class="absolute top-full left-0 bg-black/90 border border-gray-800 w-40 py-2 hidden group-hover:block rounded shadow-xl">
                        <a onclick="app.loadGenre(27, 'Terror')" class="block px-4 py-2 hover:bg-gray-800">Terror</a>
                        <a onclick="app.loadGenre(878, 'Ciencia Ficción')" class="block px-4 py-2 hover:bg-gray-800">Sci-Fi</a>
                        <a onclick="app.loadGenre(10749, 'Romance')" class="block px-4 py-2 hover:bg-gray-800">Romance</a>
                        <a onclick="app.loadGenre(16, 'Animación')" class="block px-4 py-2 hover:bg-gray-800">Infantil</a>
                    </div>
                </li>
            </ul>
        </div>

        <div class="flex items-center gap-4">
            <div class="hidden md:flex items-center search-box rounded px-2 py-1 h-9">
                <i class="fas fa-search text-white px-2 cursor-pointer"></i>
                <input type="text" id="searchInput" placeholder="Títulos, gente, géneros" 
                       class="bg-transparent border-none outline-none text-white text-sm w-32 focus:w-64 transition-all placeholder-gray-400"
                       autocomplete="off">
            </div>

            <button class="md:hidden text-white text-xl" onclick="ui.toggleMobileSearch()">
                <i class="fas fa-search"></i>
            </button>

            <i class="fas fa-bell text-white text-lg cursor-pointer hover:text-gray-300 hidden md:block"></i>

            <div class="flex items-center gap-1 cursor-pointer group relative">
                <img src="https://upload.wikimedia.org/wikipedia/commons/0/0b/Netflix-avatar.png" class="w-8 h-8 rounded">
                <i class="fas fa-caret-down text-white text-xs group-hover:rotate-180 transition-transform"></i>
                
                <div class="absolute top-full right-0 mt-2 w-48 bg-black/95 border border-gray-800 rounded hidden group-hover:block shadow-2xl p-2">
                    <p class="text-xs text-gray-400 px-2 py-1 mb-2 border-b border-gray-700">Usuario Premium</p>
                    <a href="#" class="block px-2 py-2 text-sm hover:bg-gray-800 rounded mb-1">Cuenta</a>
                    <a href="#" class="block px-2 py-2 text-sm hover:bg-gray-800 rounded mb-1">Centro de ayuda</a>
                    <a href="#" onclick="alert('Sesión cerrada (Simulación)')" class="block px-2 py-2 text-sm hover:bg-gray-800 rounded border-t border-gray-700 mt-2">Cerrar sesión de Netflix</a>
                </div>
            </div>
        </div>
    </nav>

    <div id="mobile-search-overlay" class="fixed top-0 left-0 w-full bg-[#141414] z-[60] p-4 hidden border-b border-gray-800">
        <div class="flex items-center gap-4">
            <button onclick="ui.toggleMobileSearch()" class="text-gray-400"><i class="fas fa-arrow-left text-xl"></i></button>
            <input type="text" id="mobileSearchInput" placeholder="Buscar..." class="w-full bg-[#333] text-white p-2 rounded outline-none border border-transparent focus:border-gray-500">
        </div>
    </div>

    <div class="md:hidden fixed bottom-0 w-full bg-[#121212] border-t border-gray-800 z-40 flex justify-around py-3 text-[10px] text-gray-400">
        <div onclick="app.renderHome()" class="flex flex-col items-center gap-1 cursor-pointer hover:text-white text-white">
            <i class="fas fa-home text-lg"></i>
            <span>Inicio</span>
        </div>
        <div onclick="app.loadGenre(28, 'Acción')" class="flex flex-col items-center gap-1 cursor-pointer hover:text-white">
            <i class="fas fa-fire text-lg"></i>
            <span>Acción</span>
        </div>
        <div onclick="app.loadFavorites()" class="flex flex-col items-center gap-1 cursor-pointer hover:text-white">
            <i class="fas fa-plus-circle text-lg"></i>
            <span>Mi Lista</span>
        </div>
    </div>

    <main class="min-h-screen pb-20">
        
        <header id="hero-section" class="relative h-[75vh] md:h-[95vh] w-full bg-cover bg-center hidden">
            <div class="hero-vignette"></div>
            <div class="hero-bottom-fade"></div>

            <div class="absolute bottom-[20%] left-4 md:left-12 max-w-2xl space-y-5 animate-slide-up z-10">
                
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 bg-red-600 flex items-center justify-center font-bold text-sm rounded-sm">TOP</div>
                    <span class="text-white font-bold text-lg tracking-wide">N.º 1 en Películas hoy</span>
                </div>

                <h1 id="hero-title" class="hero-title font-black leading-none drop-shadow-2xl text-white uppercase brand-logo">
                    </h1>
                
                <div class="flex items-center gap-3 text-sm font-semibold text-gray-300">
                    <span class="text-[#46d369]">98% para ti</span>
                    <span id="hero-year">2023</span>
                    <span class="border border-gray-500 px-1 text-xs">HD</span>
                </div>

                <p id="hero-desc" class="text-white text-sm md:text-lg line-clamp-3 md:line-clamp-4 drop-shadow-md max-w-xl text-shadow-sm font-light">
                    </p>

                <div class="flex items-center gap-4 pt-4">
                    <button id="hero-play-btn" class="btn-play px-8 py-3 flex items-center gap-3 text-lg shadow-lg">
                        <i class="fas fa-play"></i> Reproducir
                    </button>
                    <button id="hero-info-btn" class="btn-info px-8 py-3 flex items-center gap-3 text-lg">
                        <i class="fas fa-info-circle"></i> Más información
                    </button>
                </div>
            </div>
        </header>

        <div id="content-rows" class="relative z-20 -mt-24 md:-mt-40 space-y-8 md:space-y-12 pb-12 overflow-hidden">
            <div class="text-center mt-20 hidden" id="loading-home">
                <div class="netflix-spinner"></div>
            </div>
        </div>

        <div id="grid-view" class="hidden pt-24 px-4 md:px-12 min-h-screen animate-fade-in">
            <div class="flex justify-between items-center mb-6">
                <h2 id="grid-title" class="text-2xl md:text-3xl font-bold text-white">Resultados</h2>
                <button onclick="app.renderHome()" class="text-gray-400 hover:text-white"><i class="fas fa-times-circle text-3xl"></i></button>
            </div>
            
            <div id="grid-container" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-7 gap-4">
                </div>
            
            <div id="empty-state" class="hidden flex flex-col items-center justify-center py-32 text-gray-500">
                <i class="far fa-frown text-6xl mb-4"></i>
                <p class="text-xl">No encontramos nada con ese nombre.</p>
            </div>
        </div>

        <footer class="max-w-4xl mx-auto px-4 py-16 text-gray-500 text-sm mt-12 border-t border-gray-800">
            <div class="flex items-center gap-4 mb-6 text-white text-lg">
                <i class="fab fa-facebook-f cursor-pointer hover:text-gray-400"></i>
                <i class="fab fa-instagram cursor-pointer hover:text-gray-400"></i>
                <i class="fab fa-twitter cursor-pointer hover:text-gray-400"></i>
                <i class="fab fa-youtube cursor-pointer hover:text-gray-400"></i>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div>
                    <a href="#" class="footer-link">Audio y subtítulos</a>
                    <a href="#" class="footer-link">Prensa</a>
                    <a href="#" class="footer-link">Privacidad</a>
                    <a href="#" class="footer-link">Contáctanos</a>
                </div>
                <div>
                    <a href="#" class="footer-link">Audiodescripción</a>
                    <a href="#" class="footer-link">Relaciones con inversionistas</a>
                    <a href="#" class="footer-link">Avisos legales</a>
                </div>
                <div>
                    <a href="#" class="footer-link">Centro de ayuda</a>
                    <a href="#" class="footer-link">Empleo</a>
                    <a href="#" class="footer-link">Preferencias de cookies</a>
                </div>
                <div>
                    <a href="#" class="footer-link">Tarjetas de regalo</a>
                    <a href="#" class="footer-link">Términos de uso</a>
                    <a href="#" class="footer-link">Información corporativa</a>
                </div>
            </div>
            
            <button class="border border-gray-500 text-gray-500 px-4 py-1 mb-4 hover:text-white hover:border-white text-xs">
                Código de servicio
            </button>
            
            <p class="text-xs">© 2023-2025 JJMOVIES Inc. Todos los derechos reservados.</p>
        </footer>
    </main>

    <div id="detail-modal" class="fixed inset-0 z-[100] hidden overflow-y-auto modal-overlay flex items-center justify-center p-0 md:p-4">
        <div class="bg-[#181818] w-full max-w-5xl rounded-lg overflow-hidden shadow-2xl relative min-h-screen md:min-h-0 animate-fade-in border border-[#222]">
            
            <button onclick="ui.closeModal()" class="absolute top-4 right-4 z-50 bg-[#181818] rounded-full w-10 h-10 flex items-center justify-center text-white hover:bg-white hover:text-black transition shadow-lg">
                <i class="fas fa-times"></i>
            </button>

            <div class="relative h-[40vh] md:h-[60vh]">
                <div id="modal-backdrop" class="absolute inset-0 bg-cover bg-center"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-[#181818] via-transparent"></div>
                
                <div class="absolute bottom-8 left-6 md:left-12 right-6">
                    <h2 id="modal-title" class="text-4xl md:text-5xl font-black text-white drop-shadow-xl mb-4 brand-logo tracking-wide">TITULO</h2>
                    <div class="flex items-center gap-4">
                        <button id="modal-play-action" class="bg-white text-black px-8 py-2 rounded font-bold hover:bg-[#E50914] hover:text-white transition flex items-center gap-2">
                            <i class="fas fa-play"></i> Reproducir
                        </button>
                        <button id="modal-fav-btn" class="w-10 h-10 border-2 border-gray-500 rounded-full flex items-center justify-center text-gray-300 hover:border-white hover:text-white transition" title="Añadir a mi lista">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="w-10 h-10 border-2 border-gray-500 rounded-full flex items-center justify-center text-gray-300 hover:border-white hover:text-white transition" title="Me gusta">
                            <i class="far fa-thumbs-up"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="p-6 md:p-12 grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="md:col-span-2 text-white">
                    <div class="flex items-center gap-4 mb-4 text-sm font-bold">
                        <span class="text-[#46d369]">95% coincidencia</span>
                        <span id="modal-date">2022</span>
                        <span class="border border-white/40 px-1 rounded text-xs text-white/60">HD</span>
                        <span class="border border-white/40 px-1 rounded text-xs text-white/60">5.1</span>
                    </div>
                    <p id="modal-overview" class="text-gray-300 leading-relaxed text-base mb-6"></p>
                    <hr class="border-gray-800 mb-6">
                    
                    <h3 class="font-bold text-lg mb-4">Información técnica</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm text-gray-400">
                        <p>Género: <span id="modal-genres" class="text-white">Acción</span></p>
                        <p>Idioma original: <span id="modal-lang" class="text-white">Inglés</span></p>
                        <p>Popularidad: <span class="text-white">Alta</span></p>
                    </div>
                </div>

                <div class="text-sm text-gray-400 space-y-4">
                   <div>
                       <span class="block text-gray-500 mb-1">Elenco:</span>
                       <span class="text-white">Disponible en créditos</span>
                   </div>
                   <div>
                       <span class="block text-gray-500 mb-1">Director:</span>
                       <span class="text-white">Ver detalles</span>
                   </div>
                   <div class="mt-8 bg-[#222] p-4 rounded">
                       <p class="text-xs text-center text-gray-500">Este título está disponible para descarga.</p>
                   </div>
                </div>
            </div>
        </div>
    </div>

    <div id="player-container" class="player-fullscreen">
        <button onclick="player.close()" class="close-player-btn">
            <i class="fas fa-arrow-left"></i> Volver a navegar
        </button>
        
        <iframe id="video-frame" class="w-full h-full border-none" allowfullscreen allow="autoplay; encrypted-media"></iframe>
    </div>

    <script>
        /**
         * JJMOVIES CORE ENGINE v3.0 (Master Edition)
         * ------------------------------------------
         * Módulo principal que controla toda la lógica de la aplicación.
         * Incluye gestión de API, renderizado de DOM, gestión de estado y reproductor.
         */

        // --- CONSTANTES DE CONFIGURACIÓN ---
        const CONFIG = {
            apiKey: '15d2ea6d0dc1d476efbca3eba2b9bbfb', // API Key pública de TMDB
            baseUrl: 'https://api.themoviedb.org/3',
            imgBase: 'https://image.tmdb.org/t/p/original',
            posterBase: 'https://image.tmdb.org/t/p/w500',
            lang: 'es-MX',
            // Servidores de respaldo para el reproductor
            servers: {
                primary: 'https://vidsrc.xyz/embed',
                secondary: 'https://vidsrc.to/embed'
            }
        };

        // --- GESTIÓN DE ESTADO (LOCAL STORAGE) ---
        const State = {
            favorites: JSON.parse(localStorage.getItem('jj_favorites')) || [],
            
            addFavorite: function(movie) {
                if(!this.favorites.some(m => m.id === movie.id)) {
                    this.favorites.push(movie);
                    this.save();
                    ui.showNotification("Añadido a Mi Lista");
                    return true;
                }
                return false;
            },
            
            removeFavorite: function(id) {
                this.favorites = this.favorites.filter(m => m.id !== id);
                this.save();
                ui.showNotification("Eliminado de Mi Lista");
            },

            isFavorite: function(id) {
                return this.favorites.some(m => m.id === id);
            },

            save: function() {
                localStorage.setItem('jj_favorites', JSON.stringify(this.favorites));
            }
        };

        // --- CONTROLADOR DE INTERFAZ (UI) ---
        const ui = {
            // Navbar pegajoso con cambio de color
            initScrollListener: function() {
                window.addEventListener('scroll', () => {
                    const nav = document.getElementById('main-navbar');
                    if(window.scrollY > 50) {
                        nav.classList.add('navbar-solid');
                        nav.classList.remove('navbar-gradient');
                    } else {
                        nav.classList.add('navbar-gradient');
                        nav.classList.remove('navbar-solid');
                    }
                });
            },

            toggleMobileSearch: function() {
                const el = document.getElementById('mobile-search-overlay');
                el.classList.toggle('hidden');
                if(!el.classList.contains('hidden')) document.getElementById('mobileSearchInput').focus();
            },

            showGrid: function(show, title = '') {
                const home = document.getElementById('content-rows');
                const hero = document.getElementById('hero-section');
                const grid = document.getElementById('grid-view');
                const gridTitle = document.getElementById('grid-title');

                if(show) {
                    home.classList.add('hidden');
                    hero.classList.add('hidden');
                    grid.classList.remove('hidden');
                    if(title) gridTitle.innerText = title;
                    window.scrollTo(0,0);
                } else {
                    home.classList.remove('hidden');
                    hero.classList.remove('hidden');
                    grid.classList.add('hidden');
                }
            },

            showNotification: function(msg) {
                // Crear tostada temporal
                const div = document.createElement('div');
                div.className = 'fixed bottom-20 left-1/2 transform -translate-x-1/2 bg-white text-black px-6 py-2 rounded-full shadow-xl font-bold z-[200] animate-fade-in text-sm';
                div.innerText = msg;
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 2000);
            },

            closeModal: function() {
                document.getElementById('detail-modal').classList.add('hidden');
                document.body.style.overflow = 'auto'; // Reactivar scroll
            }
        };

        // --- LÓGICA DE LA APLICACIÓN (APP) ---
        const app = {
            init: async function() {
                console.log("Iniciando JJMOVIES Master Engine...");
                ui.initScrollListener();
                
                // Listeners de búsqueda
                this.setupSearch('searchInput');
                this.setupSearch('mobileSearchInput');

                await this.renderHome();
            },

            setupSearch: function(elementId) {
                const input = document.getElementById(elementId);
                let timeout = null;
                
                input.addEventListener('keyup', (e) => {
                    clearTimeout(timeout);
                    const query = e.target.value;
                    
                    if(query.length > 2) {
                        // Debounce para no saturar la API
                        timeout = setTimeout(() => this.searchContent(query), 500);
                    } else if (query.length === 0) {
                        this.renderHome();
                    }
                });
            },

            // --- CARGA DE DATOS ---
            
            fetchData: async function(endpoint, params = '') {
                try {
                    const url = `${CONFIG.baseUrl}${endpoint}?api_key=${CONFIG.apiKey}&language=${CONFIG.lang}${params}`;
                    const res = await fetch(url);
                    if(!res.ok) throw new Error('Error API');
                    return await res.json();
                } catch (error) {
                    console.error("Fetch Error:", error);
                    return null;
                }
            },

            renderHome: async function() {
                ui.showGrid(false);
                const rowsContainer = document.getElementById('content-rows');
                const loader = document.getElementById('loading-home');
                
                // Si ya hay contenido, no recargar todo para ahorrar datos
                if(rowsContainer.children.length > 2) return;

                loader.classList.remove('hidden');
                
                // 1. Cargar Tendencias (Hero)
                const trendingData = await this.fetchData('/trending/movie/day');
                if(trendingData && trendingData.results.length > 0) {
                    this.setupHero(trendingData.results[0]);
                }

                // 2. Limpiar contenedor
                rowsContainer.innerHTML = '';

                // 3. Cargar Carriles Paralelamente
                const categories = [
                    { title: 'Tendencias Ahora', endpoint: '/trending/movie/week' },
                    { title: 'Películas de Acción', endpoint: '/discover/movie', params: '&with_genres=28' },
                    { title: 'Comedias Populares', endpoint: '/discover/movie', params: '&with_genres=35' },
                    { title: 'Cine de Terror', endpoint: '/discover/movie', params: '&with_genres=27' },
                    { title: 'Series Top Rated', endpoint: '/tv/top_rated' },
                    { title: 'Documentales', endpoint: '/discover/movie', params: '&with_genres=99' },
                ];

                for (const cat of categories) {
                    const data = await this.fetchData(cat.endpoint, cat.params || '');
                    if(data && data.results) {
                        this.createRow(rowsContainer, cat.title, data.results);
                    }
                }

                loader.classList.add('hidden');
            },

            setupHero: function(movie) {
                const hero = document.getElementById('hero-section');
                hero.classList.remove('hidden');
                hero.style.backgroundImage = `url('${CONFIG.imgBase}${movie.backdrop_path}')`;
                
                document.getElementById('hero-title').innerText = movie.title || movie.name;
                document.getElementById('hero-desc').innerText = movie.overview;
                document.getElementById('hero-year').innerText = (movie.release_date || '2023').substring(0,4);
                
                document.getElementById('hero-play-btn').onclick = () => player.open(movie.id, 'movie');
                document.getElementById('hero-info-btn').onclick = () => this.openModal(movie);
            },

            createRow: function(container, title, items) {
                // Wrapper de la fila
                const rowDiv = document.createElement('div');
                rowDiv.className = 'pl-4 md:pl-12 relative group z-10';
                
                // Título
                const titleEl = document.createElement('h3');
                titleEl.className = 'text-gray-200 text-lg md:text-xl font-bold mb-3 flex items-center gap-2 cursor-pointer hover:text-white transition';
                titleEl.innerHTML = `${title} <i class="fas fa-chevron-right text-xs opacity-0 group-hover:opacity-100 transition-opacity text-[#E50914]"></i>`;
                rowDiv.appendChild(titleEl);

                // Slider Container
                const sliderDiv = document.createElement('div');
                sliderDiv.className = 'flex gap-2 md:gap-4 overflow-x-auto hide-scrollbar pb-8 pt-4 scroll-smooth';
                
                items.forEach(item => {
                    if(item.poster_path) {
                        const img = document.createElement('img');
                        img.src = `${CONFIG.posterBase}${item.poster_path}`;
                        img.alt = item.title;
                        img.className = 'w-32 md:w-48 rounded-md object-cover cursor-pointer movie-card bg-[#222] aspect-[2/3]';
                        img.loading = "lazy"; // Performance optimization
                        img.onclick = () => this.openModal(item);
                        sliderDiv.appendChild(img);
                    }
                });

                rowDiv.appendChild(sliderDiv);
                container.appendChild(rowDiv);
            },

            searchContent: async function(query) {
                ui.showGrid(true, `Buscando: "${query}"`);
                const container = document.getElementById('grid-container');
                container.innerHTML = '<div class="col-span-full text-center mt-10"><div class="netflix-spinner"></div></div>';

                const data = await this.fetchData('/search/multi', `&query=${encodeURIComponent(query)}&include_adult=false`);
                
                container.innerHTML = '';
                
                if(!data || !data.results.length) {
                    document.getElementById('empty-state').classList.remove('hidden');
                    return;
                } else {
                    document.getElementById('empty-state').classList.add('hidden');
                }

                const filtered = data.results.filter(i => (i.media_type === 'movie' || i.media_type === 'tv') && i.poster_path);

                filtered.forEach(item => this.createGridCard(container, item));
            },

            loadGenre: async function(genreId, genreName) {
                ui.showGrid(true, `Categoría: ${genreName}`);
                const container = document.getElementById('grid-container');
                container.innerHTML = '<div class="netflix-spinner col-span-full"></div>';

                const data = await this.fetchData('/discover/movie', `&with_genres=${genreId}&sort_by=popularity.desc`);
                container.innerHTML = '';
                
                if(data && data.results) {
                    data.results.forEach(item => this.createGridCard(container, item));
                }
            },

            loadFavorites: function() {
                ui.showGrid(true, "Mi Lista");
                const container = document.getElementById('grid-container');
                container.innerHTML = '';
                
                if(State.favorites.length === 0) {
                    container.innerHTML = '<p class="col-span-full text-center text-gray-500 mt-10">Aún no has agregado nada a tu lista.</p>';
                    return;
                }

                State.favorites.forEach(item => this.createGridCard(container, item));
            },

            createGridCard: function(container, item) {
                const card = document.createElement('div');
                card.className = 'relative group cursor-pointer bg-[#222] rounded-md overflow-hidden transition-transform duration-300 hover:scale-105 hover:z-50';
                
                const type = item.media_type === 'tv' ? 'SERIE' : 'PELÍCULA';
                const year = (item.release_date || item.first_air_date || 'N/A').split('-')[0];

                card.innerHTML = `
                    <img src="${CONFIG.posterBase}${item.poster_path}" class="w-full h-auto aspect-[2/3] object-cover opacity-90 group-hover:opacity-100">
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity p-2 flex flex-col justify-end">
                        <p class="text-xs font-bold text-white mb-1 line-clamp-1">${item.title || item.name}</p>
                        <div class="flex justify-between items-center text-[10px] text-gray-300">
                            <span>${year}</span>
                            <span class="border border-gray-600 px-1 rounded">${type}</span>
                        </div>
                    </div>
                `;
                card.onclick = () => this.openModal(item);
                container.appendChild(card);
            },

            openModal: function(item) {
                const modal = document.getElementById('detail-modal');
                const backdrop = item.backdrop_path ? CONFIG.imgBase + item.backdrop_path : '';
                
                // Popular datos
                document.getElementById('modal-backdrop').style.backgroundImage = `url('${backdrop}')`;
                document.getElementById('modal-title').innerText = item.title || item.name;
                document.getElementById('modal-overview').innerText = item.overview || "Descripción no disponible en este momento.";
                document.getElementById('modal-date').innerText = (item.release_date || item.first_air_date || '').split('-')[0];
                document.getElementById('modal-genres').innerText = "Cargando..."; // Podríamos fetchear detalles completos aquí
                document.getElementById('modal-lang').innerText = item.original_language ? item.original_language.toUpperCase() : 'EN';
                
                // Configurar Botones
                const isMovie = item.title ? true : false;
                const type = isMovie ? 'movie' : 'tv';
                
                document.getElementById('modal-play-action').onclick = () => {
                    ui.closeModal();
                    player.open(item.id, type);
                };

                // Botón favoritos lógica
                const favBtn = document.getElementById('modal-fav-btn');
                const updateFavIcon = () => {
                    if(State.isFavorite(item.id)) {
                        favBtn.innerHTML = '<i class="fas fa-check text-[#46d369]"></i>';
                    } else {
                        favBtn.innerHTML = '<i class="fas fa-plus"></i>';
                    }
                };
                updateFavIcon();

                favBtn.onclick = () => {
                    if(State.isFavorite(item.id)) {
                        State.removeFavorite(item.id);
                    } else {
                        State.addFavorite(item);
                    }
                    updateFavIcon();
                };

                // Mostrar Modal
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Bloquear scroll de fondo
            }
        };

        // --- SISTEMA DE REPRODUCTOR (PLAYER) ---
        const player = {
            open: function(tmdbId, type) {
                const container = document.getElementById('player-container');
                const iframe = document.getElementById('video-frame');
                
                // Construcción de la URL del embed
                // Usamos el servidor primario por defecto
                let url = '';
                if(type === 'movie') {
                    url = `${CONFIG.servers.primary}/movie/${tmdbId}`;
                } else {
                    // Por defecto Temporada 1, Capitulo 1
                    url = `${CONFIG.servers.primary}/tv/${tmdbId}/1/1`;
                }
                
                iframe.src = url;
                container.style.display = 'block';
                
                // Mensaje de ayuda consola
                console.log(`Reproduciendo ID: ${tmdbId} en modo ${type}`);
            },

            close: function() {
                const container = document.getElementById('player-container');
                const iframe = document.getElementById('video-frame');
                
                container.style.display = 'none';
                iframe.src = ''; // Detener la reproducción para ahorrar memoria
            }
        };

        // --- INICIALIZACIÓN ---
        window.addEventListener('load', () => {
            app.init();
        });

    </script>
</body>
</html>
