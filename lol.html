<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JJMOVIES V4.0 | BLUE CORE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { DEFAULT: '#3b82f6', light: '#60a5fa', dark: '#2563eb', glow: 'rgba(59, 130, 246, 0.5)' }
                    },
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #050505; color: white; overflow-x: hidden; }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }

        /* EFECTOS DE CRISTAL */
        .glass { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); }
        
        /* ITEMS DE SERVIDOR */
        .server-item { transition: all 0.2s; border-left: 3px solid transparent; }
        .server-item:hover { background: rgba(59, 130, 246, 0.1); }
        .server-item.active { background: rgba(59, 130, 246, 0.15); border-left-color: #3b82f6; }

        /* TABS IDIOMA */
        .lang-tab { opacity: 0.5; border-bottom: 2px solid transparent; transition: all 0.3s; }
        .lang-tab.active { opacity: 1; border-bottom-color: #3b82f6; color: #fff; }
        
        .hidden-force { display: none !important; }
    </style>
</head>
<body class="font-sans selection:bg-brand selection:text-white">

    <nav class="fixed top-0 w-full z-50 px-8 py-5 flex justify-between items-center bg-gradient-to-b from-black/90 to-transparent">
        <div class="text-3xl font-black tracking-tighter cursor-pointer" onclick="location.reload()">
            JJ<span class="text-brand">MOVIES</span> <span class="text-[10px] opacity-50 font-normal tracking-widest border border-white/20 px-2 py-0.5 rounded">V4.0</span>
        </div>
        <div class="flex items-center gap-2">
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <span class="text-xs font-bold text-green-500 tracking-widest">ONLINE</span>
        </div>
    </nav>

    <div class="fixed inset-0 z-0 pointer-events-none">
        <div id="backdrop" class="absolute inset-0 bg-cover bg-center transition-opacity duration-1000 opacity-0 scale-105"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-[#050505] via-[#050505]/80 to-transparent"></div>
        <div class="absolute inset-0 bg-gradient-to-r from-[#050505] via-[#050505]/50 to-transparent"></div>
    </div>

    <div class="relative z-10 container mx-auto px-6 h-screen flex items-center">
        <div class="max-w-3xl flex flex-col items-start gap-6 opacity-0 animate-slide-up" style="animation-delay: 0.2s;">
            
            <div class="flex items-center gap-4 text-xs font-bold tracking-[0.2em] text-gray-400 uppercase">
                <span id="meta-year" class="bg-white/10 px-3 py-1 rounded backdrop-blur">----</span>
                <span id="meta-rating" class="text-yellow-400"><i class="fas fa-star"></i> --</span>
                <span class="text-brand">4K ULTRA HD</span>
            </div>

            <h1 id="title" class="text-5xl md:text-7xl font-black leading-none text-transparent bg-clip-text bg-gradient-to-br from-white to-gray-400">
                Cargando...
            </h1>
            <h2 id="ep-title" class="text-xl text-brand font-medium hidden-force"></h2>

            <div id="series-ui" class="hidden-force flex flex-wrap gap-3 w-full max-w-lg">
                <select id="season-sel" class="flex-1 bg-white/10 border border-white/20 text-white font-bold px-4 py-3 rounded outline-none focus:border-brand cursor-pointer uppercase text-sm"></select>
                <select id="episode-sel" class="flex-1 bg-white/10 border border-white/20 text-white font-bold px-4 py-3 rounded outline-none focus:border-brand cursor-pointer uppercase text-sm"></select>
            </div>

            <p id="desc" class="text-gray-300 text-lg leading-relaxed line-clamp-3 max-w-2xl">
                Esperando ID. Agrega ?id=123 a la URL.
            </p>

            <button onclick="App.openPlayer()" class="group px-10 py-4 bg-brand hover:bg-white text-white hover:text-brand font-black rounded-full transition-all shadow-[0_0_30px_rgba(59,130,246,0.4)] flex items-center gap-3">
                <i class="fas fa-play text-xl"></i>
                <span class="tracking-widest">VER AHORA</span>
            </button>

        </div>
    </div>

    <div id="player-ui" class="fixed inset-0 z-50 bg-[#050505] hidden flex flex-col md:flex-row opacity-0 transition-opacity duration-500">
        
        <div class="relative w-full md:w-[75%] h-[40vh] md:h-full bg-black flex items-center justify-center">
            
            <div class="absolute top-0 left-0 w-full p-4 flex justify-between z-20 bg-gradient-to-b from-black/80 to-transparent pointer-events-none">
                <button onclick="App.closePlayer()" class="pointer-events-auto w-10 h-10 rounded-full bg-white/10 hover:bg-brand flex items-center justify-center transition-all text-white">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="pointer-events-auto bg-black/60 border border-white/10 px-4 py-1 rounded-full backdrop-blur">
                    <span id="playing-name" class="text-xs font-bold text-gray-300 uppercase tracking-wider">Selecciona una opción</span>
                </div>
            </div>

            <iframe id="iframe" class="w-full h-full border-0 z-10" allowfullscreen allow="autoplay; encrypted-media"></iframe>
            
            <div id="loader" class="absolute inset-0 flex flex-col items-center justify-center bg-black z-0">
                <div class="w-12 h-12 border-4 border-brand border-t-transparent rounded-full animate-spin mb-4"></div>
                <p class="text-xs font-bold text-brand tracking-widest animate-pulse">CONECTANDO...</p>
            </div>
        </div>

        <div class="w-full md:w-[25%] h-[60vh] md:h-full bg-[#0a0a0a] border-l border-white/5 flex flex-col">
            
            <div class="p-5 border-b border-white/5 bg-[#0f0f0f]">
                <h3 class="text-xs font-bold text-white uppercase tracking-widest mb-3 flex items-center gap-2">
                    <i class="fas fa-globe text-brand"></i> Idioma Preferido
                </h3>
                <div class="flex border-b border-white/10">
                    <button onclick="App.filter('LAT')" id="tab-LAT" class="lang-tab flex-1 py-2 text-[10px] font-bold uppercase active">Latino</button>
                    <button onclick="App.filter('ESP')" id="tab-ESP" class="lang-tab flex-1 py-2 text-[10px] font-bold uppercase">Castellano</button>
                    <button onclick="App.filter('SUB')" id="tab-SUB" class="lang-tab flex-1 py-2 text-[10px] font-bold uppercase">Subtitulado</button>
                </div>
            </div>

            <div id="server-list" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
            
            <div class="p-3 bg-black border-t border-white/5 text-[8px] text-center text-gray-600 uppercase font-mono">
                JJMovies V4.0 • Secure Connection
            </div>
        </div>
    </div>

    <script>
        const CFG = { 
            API: 'da8b836389708e0558de674492931977',
            BASE: 'https://api.themoviedb.org/3'
        };

        const App = {
            data: { id: null, type: 'movie', season: 1, episode: 1, servers: [], tab: 'LAT' },

            init: async () => {
                const p = new URLSearchParams(location.search);
                App.data.id = p.get('id');
                if(!App.data.id) return;

                App.data.season = p.get('season') || 1;
                App.data.episode = p.get('episode') || 1;
                if(p.get('season')) App.data.type = 'tv';

                await App.fetchTMDB();
            },

            fetchTMDB: async () => {
                try {
                    const { id, type, season, episode } = App.data;
                    const url = `${CFG.BASE}/${type}/${id}?api_key=${CFG.API}&language=es-MX&append_to_response=external_ids`;
                    const res = await fetch(url);
                    const data = await res.json();
                    
                    App.data.imdb = data.external_ids?.imdb_id;
                    let display = { ...data };

                    if(type === 'tv') {
                        const sRes = await fetch(`${CFG.BASE}/tv/${id}/season/${season}?api_key=${CFG.API}&language=es-MX`);
                        const sData = await sRes.json();
                        const ep = sData.episodes?.find(e => e.episode_number == episode) || {};
                        display.backdrop_path = ep.still_path || data.backdrop_path;
                        display.overview = ep.overview || data.overview;
                        display.epTitle = `T${season} E${episode}: "${ep.name}"`;
                        App.setupSeries(data.number_of_seasons);
                    }
                    App.updateUI(display);
                } catch(e) { console.error(e); }
            },

            updateUI: (d) => {
                document.getElementById('title').innerText = d.title || d.name;
                document.getElementById('desc').innerText = d.overview;
                document.getElementById('meta-year').innerText = (d.release_date || d.first_air_date || '----').split('-')[0];
                document.getElementById('meta-rating').innerHTML = `<i class="fas fa-star"></i> ${d.vote_average?.toFixed(1)}`;
                
                if(d.epTitle) {
                    const el = document.getElementById('ep-title');
                    el.innerText = d.epTitle;
                    el.classList.remove('hidden-force');
                }

                if(d.backdrop_path) {
                    const bg = document.getElementById('backdrop');
                    bg.style.backgroundImage = `url('https://image.tmdb.org/t/p/original${d.backdrop_path}')`;
                    bg.classList.remove('opacity-0');
                }
                
                document.querySelector('.animate-slide-up').style.opacity = 1;
            },

            setupSeries: (total) => {
                document.getElementById('series-ui').classList.remove('hidden-force');
                const s = document.getElementById('season-sel');
                const e = document.getElementById('episode-sel');
                
                s.innerHTML = ''; e.innerHTML = '';
                for(let i=1; i<=total; i++) s.innerHTML += `<option value="${i}" ${i==App.data.season?'selected':''}>TEMPORADA ${i}</option>`;
                for(let i=1; i<=50; i++) e.innerHTML += `<option value="${i}" ${i==App.data.episode?'selected':''}>EPISODIO ${i}</option>`;

                const go = () => window.location.href = `?id=${App.data.id}&season=${s.value}&episode=${e.value}`;
                s.onchange = () => { e.value=1; go(); };
                e.onchange = go;
            },

            // --- GENERADOR DE SERVIDORES ---
            generateServers: () => {
                const { id, imdb, type, season, episode } = App.data;
                const list = [];

                // 1. LATINO (SuperEmbed - Multi Lenguaje Auto)
                // Este suele detectar el idioma del navegador o dar opciones
                let superEmbed = type === 'movie' 
                    ? `https://multiembed.mov/?video_id=${id}&tmdb=1` 
                    : `https://multiembed.mov/?video_id=${id}&tmdb=1&s=${season}&e=${episode}`;
                list.push({ name: "SuperEmbed (Multi)", url: superEmbed, lang: "LAT", icon: "fa-star" });

                // 2. SMASHY STREAM (Muy potente)
                let smashy = type === 'movie'
                    ? `https://player.smashy.stream/movie/${id}`
                    : `https://player.smashy.stream/tv/${id}&s=${season}&e=${episode}`;
                list.push({ name: "Smashy (Auto)", url: smashy, lang: "LAT", icon: "fa-bolt" });

                // 3. VIDSRC (Backup Inglés/Sub)
                let vidsrc = type === 'movie'
                    ? `https://vidsrc.cc/v2/embed/movie/${id}`
                    : `https://vidsrc.cc/v2/embed/tv/${id}/${season}/${episode}`;
                list.push({ name: "VidSrc Cloud", url: vidsrc, lang: "SUB", icon: "fa-cloud" });

                // 4. UEMBED (Backup)
                let uembed = `https://uembed.xyz/?id=${id}`;
                if(type === 'tv') uembed += `&season=${season}&episode=${episode}`;
                list.push({ name: "UEmbed Player", url: uembed, lang: "SUB", icon: "fa-play-circle" });

                // 5. 2EMBED (Backup)
                let twoembed = `https://www.2embed.cc/embed/${id}`;
                if(type === 'tv') twoembed += `&s=${season}&e=${episode}`;
                list.push({ name: "2Embed", url: twoembed, lang: "SUB", icon: "fa-server" });

                // 6. EmbedMaster (Backup)
                let emaster = type === 'movie' ? `https://embedmaster.com/embed/movie/${id}` : `https://embedmaster.com/embed/tv/${id}/${season}/${episode}`;
                list.push({ name: "EmbedMaster", url: emaster, lang: "SUB", icon: "fa-hdd" });

                // 7. AutoEmbed (Latino Attempt)
                let auto = type === 'movie' ? `https://autoembed.to/movie/tmdb/${id}` : `https://autoembed.to/tv/tmdb/${id}-${season}-${episode}`;
                list.push({ name: "AutoEmbed (Lat)", url: auto, lang: "LAT", icon: "fa-magic" });

                return list;
            },

            openPlayer: () => {
                const ui = document.getElementById('player-ui');
                ui.classList.remove('hidden');
                setTimeout(() => ui.classList.remove('opacity-0'), 50);
                
                App.data.servers = App.generateServers();
                
                // Intentar detectar si hay Latino disponible y cambiar tab
                // Por defecto a LAT porque SuperEmbed suele tenerlo
                App.filter('LAT'); 
                App.play(0); // Auto-play el primero
            },

            closePlayer: () => {
                const ui = document.getElementById('player-ui');
                ui.classList.add('opacity-0');
                setTimeout(() => {
                    ui.classList.add('hidden');
                    document.getElementById('iframe').src = 'about:blank';
                }, 500);
            },

            filter: (lang) => {
                App.data.tab = lang;
                document.querySelectorAll('.lang-tab').forEach(b => b.classList.remove('active'));
                document.getElementById(`tab-${lang}`).classList.add('active');
                App.renderList();
            },

            renderList: () => {
                const c = document.getElementById('server-list');
                c.innerHTML = '';
                
                // Filtro Simple:
                // Si es LAT o ESP, mostramos los Multi/Auto (SuperEmbed, Smashy, AutoEmbed)
                // Si es SUB, mostramos VidSrc, UEmbed, etc.
                const target = App.data.tab;
                const filtered = App.data.servers.filter(s => {
                    if (target === 'LAT' || target === 'ESP') return s.lang === 'LAT';
                    return s.lang === 'SUB';
                });

                if(filtered.length === 0) {
                    c.innerHTML = '<div class="text-center text-gray-500 mt-10 text-xs">Prueba otra pestaña de idioma.</div>';
                    return;
                }

                filtered.forEach((s, idx) => {
                    const item = document.createElement('div');
                    item.className = 'server-item p-3 mb-1 bg-[#161616] rounded cursor-pointer flex justify-between items-center border border-white/5';
                    item.innerHTML = `
                        <div class="flex items-center gap-3">
                            <i class="fas ${s.icon} text-brand text-xs"></i>
                            <span class="text-xs font-bold text-gray-300">${s.name}</span>
                        </div>
                        <i class="fas fa-play text-[10px] text-gray-600"></i>
                    `;
                    item.onclick = () => {
                        App.playURL(s.url, s.name);
                        // Highlight logic (simplified)
                        Array.from(c.children).forEach(ch => ch.classList.remove('active'));
                        item.classList.add('active');
                    };
                    c.appendChild(item);
                });
                
                // Marcar el primero si es inicio
                if(c.children.length > 0) c.children[0].classList.add('active');
            },

            play: (idx) => {
                // Play logic internal
            },

            playURL: (url, name) => {
                const frame = document.getElementById('iframe');
                const loader = document.getElementById('loader');
                document.getElementById('playing-name').innerText = name;
                
                frame.classList.add('hidden-force');
                loader.classList.remove('hidden-force');
                
                // SIN PROXY, DIRECTO AL NAVEGADOR
                frame.src = url;
                
                setTimeout(() => {
                    frame.classList.remove('hidden-force');
                    loader.classList.add('hidden-force');
                }, 1500);
            }
        };
    </script>
</body>
</html>
