<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Metas 2026 Premium Ultra Max â€“ Jose Javier</title>
  <style>
    :root {
      --bg: #0a0e17;
      --card: #111827;
      --text: #f1f5f9;
      --text-dim: #94a3b8;
      --accent: #4f46e5;
      --accent-hover: #4338ca;
      --success: #10b981;
      --danger: #ef4444;
      --gold: #d4af37;
      --border: #1f2937;
      --shadow: 0 4px 20px rgba(0,0,0,0.4);
      --light-bg: #f8fafc;
      --light-card: #ffffff;
      --light-text: #0f172a;
      --light-text-dim: #64748b;
      --light-border: #e2e8f0;
      --transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      margin: 0;
      padding: 16px;
      transition: background 0.6s ease, color 0.6s ease;
    }
    body.light {
      --bg: var(--light-bg);
      --card: var(--light-card);
      --text: var(--light-text);
      --text-dim: var(--light-text-dim);
      --border: var(--light-border);
      --shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .toggle-mode {
      position: fixed;
      top: 16px;
      right: 16px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      transition: var(--transition);
      font-size: 1.6rem;
      z-index: 9999;
    }
    .toggle-mode:hover { transform: scale(1.15); }

    header { text-align: center; margin: 20px 0 28px; }
    h1 { font-size: 2.4rem; color: var(--accent); margin-bottom: 6px; }
    .subtitle { color: var(--text-dim); font-size: 1.05rem; }

    .quote {
      background: var(--card);
      border-radius: 20px;
      padding: 20px;
      margin: 24px 0;
      text-align: center;
      font-style: italic;
      color: var(--accent);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      font-size: 1.1rem;
      line-height: 1.5;
    }

    .overview {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
      margin: 28px 0;
    }
    .stat-card {
      background: var(--card);
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      transition: var(--transition);
    }
    .stat-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(79,70,229,0.2); }
    .stat-value { font-size: 2.5rem; font-weight: 700; color: var(--gold); }
    .stat-label { font-size: 0.95rem; color: var(--text-dim); margin-top: 6px; }

    .section {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      margin: 28px 0;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .section-title { color: var(--gold); font-size: 1.4rem; margin-bottom: 16px; text-align: center; }

    .progress { height: 14px; background: var(--border); border-radius: 7px; overflow: hidden; margin: 16px 0; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent), #7c3aed); transition: width 1.4s cubic-bezier(0.25, 0.8, 0.25, 1); }

    .input-group { display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px; justify-content: center; }
    input[type="number"], input[type="text"], input[type="date"], select {
      padding: 14px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      flex: 1 1 140px;
      font-size: 1rem;
      min-width: 140px;
    }

    button {
      padding: 14px 24px;
      border: none;
      border-radius: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }
    button:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(79,70,229,0.3); }
    button:active::after {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      width: 0; height: 0;
      background: rgba(255,255,255,0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: ripple 0.6s;
    }
    @keyframes ripple { to { width: 400px; height: 400px; opacity: 0; } }

    .btn-add { background: var(--accent); color: white; }
    .btn-reset { background: #374151; color: white; }
    .btn-danger { background: var(--danger); color: white; }

    .goals-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 28px 0; }
    .goal-card {
      background: var(--card);
      border-radius: 20px;
      padding: 20px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      transition: var(--transition);
      opacity: 0;
      transform: translateY(30px);
    }
    .goal-card.loaded { opacity: 1; transform: translateY(0); }
    .goal-card:hover { transform: translateY(-10px) scale(1.03); box-shadow: 0 20px 40px rgba(79,70,229,0.25); }
    .goal-card.completed { opacity: 0.92; border-left: 6px solid var(--success); }
    .goal-name { font-size: 1.3rem; color: var(--accent); margin-bottom: 10px; }
    .goal-details { font-size: 0.95rem; color: var(--text-dim); margin-bottom: 12px; line-height: 1.4; }
    .delete-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--danger);
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      font-size: 1.3rem;
      cursor: pointer;
    }

    .chart-container {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      margin: 28px 0;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }

    .history {
      background: var(--card);
      border-radius: 20px;
      padding: 24px;
      margin: 32px 0;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
    }
    .history ul { list-style: none; padding: 0; margin: 0; }
    .history li { padding: 12px 0; border-bottom: 1px solid var(--border); font-size: 0.95rem; }

    .confetti { position: fixed; inset: 0; pointer-events: none; z-index: 1000; }
    .confetti-piece { position: absolute; border-radius: 50%; opacity: 0; pointer-events: none; }

    @media (min-width: 600px) {
      body { max-width: 960px; margin: 0 auto; padding: 32px 24px; }
      .goals-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <button class="toggle-mode" onclick="toggleMode()">ðŸŒ™</button>

  <header>
    <h1>Metas 2026 Premium Ultra Max</h1>
    <div class="subtitle">Jose Javier â€¢ Philadelphia â€¢ Enero 2026</div>
  </header>

  <div class="quote" id="dailyQuote">Frase motivadora del dÃ­a...</div>

  <div class="overview">
    <div class="stat-card">
      <div class="stat-value" id="totalAhorro">$0</div>
      <div class="stat-label">Total Ahorros</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="progresoGlobal">0%</div>
      <div class="stat-label">Progreso Global</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="metasCompletadas">0/4</div>
      <div class="stat-label">Metas Cumplidas</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="streakValue">0</div>
      <div class="stat-label">Streak Semanal</div>
    </div>
  </div>

  <!-- AHORROS -->
  <div class="section">
    <div class="section-title">Ahorros</div>
    <div class="savings-amount" id="ahorrado">$0</div>
    <div class="progress"><div id="progressBar" class="progress-bar"></div></div>
    <div id="metaText">de $15,000 (0%)</div>
    <div class="input-group">
      <input type="number" id="ingreso" placeholder="Ingreso ($)" min="0" step="1">
      <button class="btn-add" onclick="agregarIngreso()">+ Agregar ingreso</button>
      <button class="btn-reset" onclick="resetAhorro()">Resetear todo</button>
    </div>
  </div>

  <!-- GASTOS -->
  <div class="section">
    <div class="section-title">Gastos</div>
    <div class="input-group">
      <input type="number" id="gasto" placeholder="Monto gasto ($)" min="0" step="1">
      <select id="gastoCat">
        <option value="">CategorÃ­a</option>
        <option value="Comida">Comida</option>
        <option value="Transporte">Transporte</option>
        <option value="Entretenimiento">Entretenimiento</option>
        <option value="Otros">Otros</option>
      </select>
      <button class="btn-danger" onclick="registrarGasto()">- Registrar Gasto</button>
    </div>
  </div>

  <!-- CHECK-IN SEMANAL -->
  <div class="section">
    <div class="section-title">Check-in Semanal ($30 min)</div>
    <div class="streak-badge" id="streakBadge">Streak: 0 semanas</div>
    <div class="input-group">
      <input type="number" id="weeklyAmount" placeholder="Ahorro esta semana ($)" min="0" step="1">
      <button class="btn-add" onclick="logWeekly()">Log Semanal</button>
      <button class="btn-danger" onclick="logNoSavings()">No ahorrÃ©</button>
    </div>
  </div>

  <!-- PRIORIDADES -->
  <div class="section">
    <h2>Prioridades</h2>
    <div class="goals-grid" id="prioritiesContainer"></div>
  </div>

  <!-- AÃ‘ADIR META -->
  <div class="add-form">
    <h2>AÃ±adir Meta Extra</h2>
    <input type="text" id="newName" placeholder="Nombre de meta">
    <input type="number" id="newTarget" placeholder="Target ($)" min="0" step="1">
    <input type="date" id="newDueDate" placeholder="Fecha lÃ­mite (opcional)">
    <button class="btn-add" onclick="addExtra()">AÃ±adir Meta</button>
  </div>

  <!-- METAS EXTRAS -->
  <div class="section">
    <h2>Metas Extras</h2>
    <div class="goals-grid" id="extrasContainer"></div>
  </div>

  <!-- FONDO GLOBAL -->
  <div class="section">
    <h2>Fondo Global (distribuye proporcional)</h2>
    <div class="input-group">
      <input type="number" id="globalFund" placeholder="Monto a distribuir ($)" min="0" step="1">
      <button class="btn-add" onclick="addGlobalFund()">+ Distribuir</button>
    </div>
  </div>

  <!-- GRÃFICOS -->
  <div class="chart-container">
    <h2>DistribuciÃ³n de Ahorros</h2>
    <canvas id="fundsChart" height="200"></canvas>
  </div>

  <div class="chart-container">
    <h2>Ahorros vs Gastos Mensuales</h2>
    <canvas id="monthlyChart" height="200"></canvas>
  </div>

  <!-- HISTORIA -->
  <div class="history">
    <h2>Historia Reciente</h2>
    <ul id="historyList"></ul>
  </div>

  <!-- EXPORT/IMPORT -->
  <div style="text-align:center; margin:40px 0;">
    <button class="btn-add" onclick="exportData()">Exportar JSON</button>
    <button class="btn-add" onclick="exportCSV()">Exportar CSV</button>
    <input type="file" id="importFile" style="display:none;" onchange="importData()">
    <button class="btn-add" onclick="document.getElementById('importFile').click()">Importar JSON</button>
  </div>

  <div id="confetti" class="confetti"></div>

  <script>
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // CONFIGURACIÃ“N INICIAL
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const META_AHORRO = 15000;
    let goals = JSON.parse(localStorage.getItem('metas2026_ultra')) || [
      { id: 1, name: 'Carro barato y confiable', target: 5000, current: 0, completed: false, isPriority: true, notes: '', dueDate: '' },
      { id: 2, name: 'DJI Mini 4K para papÃ¡', target: 299, current: 0, completed: false, isPriority: true, notes: '', dueDate: '' },
      { id: 3, name: 'TelÃ©fono para transmisiones', target: 800, current: 0, completed: false, isPriority: true, notes: '', dueDate: '' },
      { id: 4, name: 'Google Pixel 10 Pro (128GB)', target: 799, current: 0, completed: false, isPriority: true, notes: '', dueDate: '', details: '128 GB (mÃ¡s barato/popular): $799 (original ~$999, ahorras $200). Colores: Obsidian (negro), Moonstone, Porcelain. Ejemplo: Pixel 10 Pro 128GB Unlocked Obsidian' }
    ];
    let history = JSON.parse(localStorage.getItem('history2026_ultra')) || [];
    let weeklyLogs = JSON.parse(localStorage.getItem('weekly2026_ultra')) || { lastWeek: 0, streak: 0, badge: '' };
    let mode = localStorage.getItem('mode2026_ultra') || 'dark';

    const quotes = [
      "El ahorro es el primer gran secreto del Ã©xito. - Napoleon Hill",
      "No ahorres lo que queda despuÃ©s de gastar, gasta lo que queda despuÃ©s de ahorrar. - Warren Buffett",
      "PequeÃ±os ahorros diarios llevan a grandes metas. Â¡TÃº puedes!",
      "Cada dÃ³lar ahorrado es un paso hacia tu libertad financiera.",
      "La disciplina en el ahorro es la clave para un futuro brillante.",
      "El dinero es mejor que la pobreza, aunque solo sea por razones financieras. - Woody Allen",
      "Antes de que puedas convertirte en millonario, debes aprender a pensar como uno. - T. Harv Eker",
      "El riesgo proviene de no saber lo que estÃ¡s haciendo. - Warren Buffett",
      "El dinero es un terrible maestro, pero un excelente sirviente. - P.T. Barnum",
      "Invierte en ti mismo, es la mejor inversiÃ³n que puedes hacer. - Warren Buffett",
      "El Ã©xito financiero comienza con un plan y disciplina diaria.",
      "No esperes a tener dinero para ahorrar; ahorra para tener dinero.",
      "Tu futuro financiero depende de las decisiones de hoy.",
      "Ahorra como si fueras pobre, vive como si fueras rico.",
      "La constancia vence a la inteligencia cuando la inteligencia no es constante.",
      "Sigue adelante, Jose! Tu Pixel estÃ¡ mÃ¡s cerca de lo que piensas.",
      "El futuro pertenece a quienes creen en la belleza de sus sueÃ±os. - Eleanor Roosevelt",
      "Un viaje de mil millas comienza con un solo paso. - Lao Tzu",
      "Lo que haces hoy puede mejorar todos tus maÃ±anas. - Ralph Marston",
      "La disciplina es elegir entre lo que quieres ahora y lo que quieres de verdad.",
      "El Ã©xito no es el resultado de la capacidad, sino de la persistencia.",
      "El dinero crece en el bolsillo de quien lo respeta.",
      "No compres lo que no necesitas para impresionar a quien no te importa.",
      "La riqueza se construye en silencio, un dÃ³lar a la vez.",
      "Tu mejor inversiÃ³n es en tu educaciÃ³n financiera.",
      "El tiempo es dinero, pero el dinero puede comprar tiempo.",
      "Ahorra hoy para sonreÃ­r maÃ±ana.",
      "Los ricos tienen dinero trabajando para ellos; los pobres trabajan por dinero.",
      "La libertad financiera no es un destino, es un camino.",
      "Cada no al gasto innecesario es un sÃ­ a tu futuro."
    ];

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // FUNCIONES AUXILIARES
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getCurrentWeek() {
      const now = new Date();
      const start = new Date(now.getFullYear(), 0, 1);
      return Math.ceil((((now - start) / 86400000) + start.getDay() + 1) / 7);
    }

    function saveData() {
      localStorage.setItem('metas2026_ultra', JSON.stringify(goals));
      localStorage.setItem('history2026_ultra', JSON.stringify(history));
      localStorage.setItem('weekly2026_ultra', JSON.stringify(weeklyLogs));
      localStorage.setItem('mode2026_ultra', mode);
    }

    function checkWeeklyReminder() {
      const currentWeek = getCurrentWeek();
      if (currentWeek > weeklyLogs.lastWeek) {
        alert('Â¡Nueva semana! Registra tu ahorro semanal (mÃ­nimo $30 para streak).');
      }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // RENDERIZADO PRINCIPAL
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderGoals() {
      const priorities = goals.filter(g => g.isPriority);
      const extras = goals.filter(g => !g.isPriority);
      document.getElementById('prioritiesContainer').innerHTML = priorities.map(renderGoalCard).join('');
      document.getElementById('extrasContainer').innerHTML = extras.map(renderGoalCard).join('');

      updateOverview();
      updateChart();
      updateMonthlyChart();
      updateHistory();
      updateStreak();
      updateQuote();
      document.body.classList.toggle('light', mode === 'light');

      document.querySelectorAll('.stat-card, .goal-card').forEach((el, i) => {
        setTimeout(() => el.classList.add('loaded'), i * 80);
      });
    }

    function renderGoalCard(g) {
      const porc = (g.current / g.target * 100).toFixed(0);
      const avgWeekly = history.filter(h => h.goal === g.name && h.amount > 0).reduce((sum, h) => sum + h.amount, 0) / (history.filter(h => h.goal === g.name).length || 1);
      const estimatedWeeks = avgWeekly > 0 ? ((g.target - g.current) / avgWeekly).toFixed(1) : 'â€”';
      const daysLeft = g.dueDate ? Math.max(0, Math.ceil((new Date(g.dueDate) - new Date()) / 86400000)) : 'Sin fecha';
      return `
        <div class="goal-card ${g.completed ? 'completed' : ''}">
          <h3 class="goal-name">${g.name}</h3>
          ${g.details ? `<p class="goal-details">${g.details}</p>` : ''}
          <p>Notas: <span onclick="editNotes(${g.id})">${g.notes || 'AÃ±adir nota'}</span></p>
          <div>Target: $${g.target.toLocaleString()} | Actual: $${g.current.toLocaleString()}</div>
          <div class="progress"><div class="progress-bar" style="width:${porc}%"></div></div>
          <div>${porc}% | ~${estimatedWeeks} semanas</div>
          <div>DÃ­as restantes: ${daysLeft}</div>
          <div class="input-group" style="margin-top:12px;">
            <input type="number" id="fund${g.id}" placeholder="AÃ±adir $" min="0" step="1">
            <button class="btn-add" onclick="addFund(${g.id})">+ Fondo</button>
          </div>
          <button class="btn-complete" onclick="toggleComplete(${g.id})">${g.completed ? 'Desmarcar' : 'Cumplido'}</button>
          ${g.isPriority ? '' : `<button class="btn-edit" onclick="editGoal(${g.id})">Editar</button><button class="delete-btn" onclick="deleteGoal(${g.id})">Ã—</button>`}
        </div>
      `;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // FUNCIONES PRINCIPALES
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function agregarIngreso() {
      const val = parseFloat(document.getElementById('ingreso').value);
      if (isNaN(val) || val <= 0) return alert('Ingresa monto positivo');
      addGlobalFund(); // Reutiliza distribuciÃ³n proporcional
      document.getElementById('ingreso').value = '';
    }

    function resetAhorro() {
      if (confirm('Â¿Resetear TODOS los ahorros a $0? Esto afecta todas las metas.')) {
        goals.forEach(g => g.current = 0);
        history = [];
        saveData();
        renderGoals();
      }
    }

    function registrarGasto() {
      const monto = parseFloat(document.getElementById('gasto').value);
      const cat = document.getElementById('gastoCat').value;
      if (isNaN(monto) || monto <= 0) return alert('Ingresa monto positivo');
      if (!cat) return alert('Selecciona categorÃ­a');
      const totalCurrent = goals.reduce((sum, g) => sum + g.current, 0);
      if (monto > totalCurrent) return alert('No tienes suficiente ahorro');
      const remaining = goals.reduce((sum, g) => sum + (g.completed ? 0 : g.current), 0);
      goals.forEach(g => {
        if (g.completed || g.current <= 0) return;
        const portion = monto * (g.current / remaining);
        g.current -= portion;
        addToHistory(-portion, g.name + ' (gasto: ' + cat + ')');
      });
      addToHistory(-monto, 'Gasto total: ' + cat);
      saveData();
      renderGoals();
      document.getElementById('gasto').value = '';
      document.getElementById('gastoCat').value = '';
      alert('Gasto registrado y distribuido proporcional.');
    }

    function addFund(id) {
      const input = document.getElementById(`fund${id}`);
      const val = parseFloat(input.value);
      if (isNaN(val) || val <= 0) return alert('Ingresa monto positivo');
      const goal = goals.find(g => g.id === id);
      goal.current = Math.min(goal.current + val, goal.target);
      addToHistory(val, goal.name);
      checkMilestone(goal);
      saveData();
      renderGoals();
      input.value = '';
    }

    function addGlobalFund() {
      const val = parseFloat(document.getElementById('globalFund')?.value || document.getElementById('ingreso')?.value);
      if (isNaN(val) || val <= 0) return alert('Ingresa monto positivo');
      const remaining = goals.reduce((sum, g) => sum + (g.target - g.current), 0);
      if (remaining <= 0) return alert('Â¡Todas las metas ya estÃ¡n completas!');
      goals.forEach(g => {
        if (g.completed) return;
        const portion = val * ((g.target - g.current) / remaining);
        g.current = Math.min(g.current + portion, g.target);
        addToHistory(portion, g.name + ' (global)');
        checkMilestone(g);
      });
      saveData();
      renderGoals();
      if (document.getElementById('globalFund')) document.getElementById('globalFund').value = '';
    }

    function toggleComplete(id) {
      const goal = goals.find(g => g.id === id);
      goal.completed = !goal.completed;
      if (goal.completed) showConfetti();
      saveData();
      renderGoals();
    }

    function editGoal(id) {
      const goal = goals.find(g => g.id === id);
      const newName = prompt('Nuevo nombre:', goal.name);
      const newTarget = parseFloat(prompt('Nuevo target ($):', goal.target));
      const newDue = prompt('Fecha lÃ­mite (YYYY-MM-DD):', goal.dueDate);
      if (newName) goal.name = newName;
      if (!isNaN(newTarget) && newTarget > 0) goal.target = newTarget;
      if (newDue) goal.dueDate = newDue;
      saveData();
      renderGoals();
    }

    function editNotes(id) {
      const goal = goals.find(g => g.id === id);
      const newNotes = prompt('Notas:', goal.notes || '');
      if (newNotes !== null) goal.notes = newNotes.trim();
      saveData();
      renderGoals();
    }

    function deleteGoal(id) {
      if (confirm('Â¿Eliminar esta meta extra?')) {
        goals = goals.filter(g => g.id !== id);
        saveData();
        renderGoals();
      }
    }

    function addExtra() {
      const name = document.getElementById('newName').value.trim();
      const target = parseFloat(document.getElementById('newTarget').value);
      const dueDate = document.getElementById('newDueDate').value;
      if (!name || isNaN(target) || target <= 0) return alert('Nombre y monto objetivo vÃ¡lidos');
      const newId = Math.max(...goals.map(g => g.id || 0)) + 1;
      goals.push({
        id: newId,
        name,
        target,
        current: 0,
        completed: false,
        isPriority: false,
        notes: '',
        dueDate
      });
      saveData();
      renderGoals();
      document.getElementById('newName').value = '';
      document.getElementById('newTarget').value = '';
      document.getElementById('newDueDate').value = '';
    }

    function logWeekly() {
      const amount = parseFloat(document.getElementById('weeklyAmount').value || 0);
      const currentWeek = getCurrentWeek();
      if (currentWeek <= weeklyLogs.lastWeek) return alert('Ya logueaste esta semana');
      const metMin = amount >= 30;
      weeklyLogs.streak = metMin ? weeklyLogs.streak + 1 : 0;
      updateBadge();
      weeklyLogs.lastWeek = currentWeek;
      addToHistory(amount, 'Check-in Semanal');
      saveData();
      renderGoals();
      document.getElementById('weeklyAmount').value = '';
      alert(metMin ? 'Â¡Excelente! Streak +1 ðŸ’ª' : 'OK, intenta $30 la prÃ³xima');
    }

    function logNoSavings() {
      if (confirm('Â¿Confirmar no ahorrÃ© nada esta semana? Resetea streak.')) {
        weeklyLogs.streak = 0;
        updateBadge();
        addToHistory(0, 'No ahorrÃ© esta semana');
        saveData();
        renderGoals();
      }
    }

    function updateBadge() {
      if (weeklyLogs.streak >= 20) weeklyLogs.badge = 'ðŸ† Oro';
      else if (weeklyLogs.streak >= 10) weeklyLogs.badge = 'ðŸ¥ˆ Plata';
      else if (weeklyLogs.streak >= 3) weeklyLogs.badge = 'ðŸ¥‰ Bronce';
      else weeklyLogs.badge = '';
      document.getElementById('streakBadge').textContent = `Streak: ${weeklyLogs.streak} semanas ${weeklyLogs.badge}`;
    }

    function checkMilestone(goal) {
      const porc = (goal.current / goal.target) * 100;
      if ([25, 50, 75, 100].some(m => porc >= m && (goal.lastMilestone || 0) < m)) {
        goal.lastMilestone = Math.floor(porc / 25) * 25;
        alert(`Â¡Milestone: ${goal.lastMilestone}% en ${goal.name}! ðŸŽ‰`);
        showConfetti();
      }
    }

    function showConfetti() {
      const confetti = document.getElementById('confetti');
      confetti.innerHTML = '';
      const colors = ['#4f46e5', '#10b981', '#d4af37', '#ef4444', '#fbbf24', '#ec4899'];
      for (let i = 0; i < 150; i++) {
        const piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.left = Math.random() * 100 + '%';
        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
        piece.style.width = piece.style.height = (Math.random() * 12 + 6) + 'px';
        piece.style.animation = `confettiFall ${Math.random() * 3 + 2}s linear forwards`;
        piece.style.animationDelay = Math.random() * 0.8 + 's';
        confetti.appendChild(piece);
      }
      setTimeout(() => confetti.innerHTML = '', 5000);
    }

    function updateOverview() {
      const totalCurrent = goals.reduce((sum, g) => sum + g.current, 0);
      const totalTarget = goals.reduce((sum, g) => sum + g.target, 0);
      const porc = totalTarget > 0 ? Math.round((totalCurrent / totalTarget) * 100) : 0;
      const completed = goals.filter(g => g.completed).length;

      document.getElementById('totalAhorro').textContent = '$' + totalCurrent.toLocaleString();
      document.getElementById('progresoGlobal').textContent = porc + '%';
      document.getElementById('metasCompletadas').textContent = completed + '/' + goals.length;
      document.getElementById('ahorrado').textContent = '$' + totalCurrent.toLocaleString();
      document.getElementById('metaText').textContent = `de $${META_AHORRO.toLocaleString()} (${porc}%)`;
      document.getElementById('progressBar').style.width = porc + '%';
    }

    function updateChart() {
      const ctx = document.getElementById('fundsChart').getContext('2d');
      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: goals.map(g => g.name),
          datasets: [{
            data: goals.map(g => g.current),
            backgroundColor: ['#4f46e5', '#10b981', '#d4af37', '#ef4444', '#fbbf24', '#a78bfa', '#ec4899']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom', labels: { color: var('--text-dim') } }
          }
        }
      });
    }

    function updateMonthlyChart() {
      const monthlyData = {};
      history.forEach(h => {
        const month = h.date.split('/')[0] + '/' + h.date.split('/')[2]; // MM/YYYY
        if (!monthlyData[month]) monthlyData[month] = { ingresos: 0, gastos: 0 };
        if (h.amount > 0) monthlyData[month].ingresos += parseFloat(h.amount);
        else monthlyData[month].gastos += Math.abs(parseFloat(h.amount));
      });

      const labels = Object.keys(monthlyData);
      const ingresos = labels.map(m => monthlyData[m].ingresos);
      const gastos = labels.map(m => monthlyData[m].gastos);

      const ctx = document.getElementById('monthlyChart').getContext('2d');
      if (window.monthlyChart) window.monthlyChart.destroy();
      window.monthlyChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            { label: 'Ingresos', data: ingresos, backgroundColor: '#10b981' },
            { label: 'Gastos', data: gastos, backgroundColor: '#ef4444' }
          ]
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true } },
          plugins: { legend: { position: 'bottom' } }
        }
      });
    }

    function addToHistory(amount, goalName) {
      const date = new Date().toLocaleString('es-US', { dateStyle: 'short', timeStyle: 'short' });
      history.unshift({ amount: amount.toFixed(2), goal: goalName, date });
      if (history.length > 20) history.pop();
      saveData();
    }

    function updateHistory() {
      document.getElementById('historyList').innerHTML = history.map(h => `
        <li style="color:${h.amount > 0 ? 'var(--success)' : 'var(--danger)'}">
          ${h.amount > 0 ? '+' : ''}$${Math.abs(h.amount)} a ${h.goal} (${h.date})
        </li>
      `).join('');
    }

    function updateStreak() {
      document.getElementById('streakValue').textContent = weeklyLogs.streak;
      document.getElementById('streakBadge').textContent = `Streak: ${weeklyLogs.streak} semanas ${weeklyLogs.badge}`;
    }

    function updateQuote() {
      const today = new Date().toDateString();
      const lastDate = localStorage.getItem('lastQuoteDate');
      let index = parseInt(localStorage.getItem('quoteIndex')) || 0;
      if (today !== lastDate) {
        index = Math.floor(Math.random() * quotes.length);
        localStorage.setItem('quoteIndex', index);
        localStorage.setItem('lastQuoteDate', today);
      }
      document.getElementById('dailyQuote').textContent = quotes[index];
    }

    function toggleMode() {
      mode = mode === 'dark' ? 'light' : 'dark';
      saveData();
      renderGoals();
    }

    function exportData() {
      const data = { goals, history, weeklyLogs };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'metas-2026-backup.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function exportCSV() {
      let csv = 'ID,Nombre,Target,Current,Completed,DueDate,Notes\n';
      goals.forEach(g => csv += `${g.id},"${g.name.replace(/"/g,'""')}",${g.target},${g.current},${g.completed},${g.dueDate || ''},"${(g.notes || '').replace(/"/g,'""')}"\n`);
      csv += '\nHistoria\nAmount,Goal,Date\n';
      history.forEach(h => csv += `${h.amount},"${h.goal.replace(/"/g,'""')}",${h.date}\n`);
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'metas-2026.csv';
      a.click();
      URL.revokeObjectURL(url);
    }

    function importData() {
      const file = document.getElementById('importFile').files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          goals = data.goals || goals;
          history = data.history || history;
          weeklyLogs = data.weeklyLogs || weeklyLogs;
          saveData();
          renderGoals();
          alert('Datos importados correctamente');
        } catch (err) {
          alert('Error al importar: ' + err.message);
        }
      };
      reader.readAsText(file);
    }

    // InicializaciÃ³n
    checkWeeklyReminder();
    renderGoals();
  </script>
</body>
</html>
