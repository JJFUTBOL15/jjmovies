<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproduciendo en JJMovies.lat</title>
    <style>
        body, html { margin:0; padding:0; height:100%; background:#000; color:white; font-family:Arial; overflow:hidden; }
        .container { position:relative; width:100%; height:100%; }
        iframe { width:100%; height:100%; border:none; }
        .title { position:absolute; top:20px; left:50%; transform:translateX(-50%); font-size:32px; z-index:10; text-shadow: 2px 2px 4px black; }
        .loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:28px; z-index:10; }
    </style>
</head>
<body>
    <div class="container">
        <div class="title" id="title">Cargando película...</div>
        <div class="loading">Conectando al servidor de FlixHQ/Cuevana...</div>
        <iframe id="player" allowfullscreen allow="autoplay"></iframe>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const id = params.get('id');
        const season = params.get('season');
        const episode = params.get('episode');

        if (!id) {
            document.getElementById('title').textContent = 'Agrega ?id=NUMERO';
            return;
        }

        // Base real de FlixHQ/Cuevana (multiembed/superembed direct)
        let main = `https://multiembed.mov/directstream.php?video_id=${id}&tmdb=1`;
        if (season && episode) {
            main += `&s=${season}&e=${episode}`;
        }

        // Fallbacks top 2025
        const fallbacks = [
            `https://vidsrc.to/embed/movie/${id}${season ? `/tv/${id}-${season}-${episode}` : ''}`,
            `https://vembed.click/embed/movie/${id}${season ? `/tv/${id}-${season}-${episode}` : ''}`,
            `https://autoembed.cc/movie/tmdb/${id}${season ? `-${season}-${episode}` : ''}`
        ];

        const iframe = document.getElementById('player');
        let current = 0;

        function loadSource() {
            if (current === 0) {
                iframe.src = main;
            } else if (current - 1 < fallbacks.length) {
                iframe.src = fallbacks[current - 1];
            } else {
                document.querySelector('.loading').textContent = 'Prueba otra película o refresca';
            }
            current++;
        }

        fetch(`https://api.themoviedb.org/3/${season ? 'tv' : 'movie'}/${id}?api_key=936410eebae74f9895643e085cc4a740&language=es-ES`)
            .then(res => res.json())
            .then(data => document.getElementById('title').textContent = (season ? data.name : data.title) || 'JJMovies.lat');

        iframe.onload = () => document.querySelector('.loading').style.display = 'none';
        iframe.onerror = loadSource;

        loadSource();
    </script>
</body>
</html>
